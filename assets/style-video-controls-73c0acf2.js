if(typeof AFRAME>"u")throw new Error("Component attempted to register before AFRAME was available.");var m="Double-click outside player to hide or show it.",b="Look+click on play or bar. Space bar and arrows also work.";AFRAME.registerComponent("video-controls",{schema:{src:{type:"string"},size:{type:"number",default:1},distance:{type:"number",default:2},backgroundColor:{default:"black"},barColor:{default:"red"},textColor:{default:"yellow"},infoTextBottom:{default:m},infoTextTop:{default:b},infoTextFont:{default:"35px Helvetica Neue"},statusTextFont:{default:"30px Helvetica Neue"},timeTextFont:{default:"70px Helvetica Neue"}},position_time_from_steps:function(){var e=this.current_step/this.bar_steps;this.video_el.readyState>0&&(this.video_el.currentTime=e*this.video_el.duration)},position_control_from_camera:function(){var e=this,i=e.el.sceneEl.camera;if(i){var a=i.el.getAttribute("rotation"),t=a.y;e.y_position=1,e.x_position=-e.data.distance*Math.sin(t*Math.PI/180),e.z_position=-e.data.distance*Math.cos(t*Math.PI/180),e.el.setAttribute("position",[e.x_position,e.y_position,e.z_position].join(" "));let s=new THREE.Vector3;i.getWorldPosition(s),this.el.object3D.lookAt(s)}},init:function(){var e=this;this.bar_steps=10,this.current_step=0,this.el.setAttribute("visible",!0),e.play_image_src=document.getElementById("video-play-image")?"#video-play-image":"https://res.cloudinary.com/dxbh0pppv/image/upload/c_scale,h_512,q_10/v1471016296/play_wvmogo.png",e.pause_image_src=document.getElementById("video-pause-image")?"#video-pause-image":"https://res.cloudinary.com/dxbh0pppv/image/upload/c_scale,h_512,q_25/v1471016296/pause_ndega5.png",this.play_image=document.createElement("a-image"),this.play_image.classList.add("clickable"),this.bar_canvas=document.createElement("canvas"),this.bar_canvas.setAttribute("id","video_player_canvas"),this.bar_canvas.width=1024,this.bar_canvas.height=256,this.bar_canvas.style.display="none",this.context=this.bar_canvas.getContext("2d"),this.texture=new THREE.Texture(this.bar_canvas),this.play_image.addEventListener("click",function(i){e.video_el.paused?(this.setAttribute("src",e.pause_image_src),e.video_el.play()):(this.setAttribute("src",e.play_image_src),e.video_el.pause()),i.stopPropagation(),i.preventDefault()}),window.addEventListener("keyup",function(i){switch(i.keyCode){case 32:e.play_image.dispatchEvent(new Event("click"));break;case 37:e.current_step=0,e.position_time_from_steps();break;case 39:e.current_step=e.bar_steps,e.position_time_from_steps();break;case 38:e.current_step=e.current_step<e.bar_steps?e.current_step+1:e.current_step,e.position_time_from_steps();break;case 40:e.current_step=e.current_step>0?e.current_step-1:e.current_step,e.position_time_from_steps();break}},!1),this.bar=document.createElement("a-plane"),this.bar.addEventListener("click",function(i){var a=document.querySelector("a-cursor").components.raycaster.raycaster.intersectObject(this.object3D,!0)[0].point,t=this.object3D.worldToLocal(a).x,s=t/e.data.size+.5;e.current_step=Math.round(s*e.bar_steps),e.video_el.readyState>0&&(e.video_el.currentTime=s*e.video_el.duration),i.stopPropagation(),i.preventDefault()}),this.el.appendChild(this.bar_canvas),this.el.appendChild(this.play_image),this.el.appendChild(this.bar),this.el.sceneEl.addEventListener("loaded",function(){e.position_control_from_camera(),this.addEventListener("dblclick",function(){var i=document.querySelector("a-cursor").components.raycaster.raycaster;i.intersectObject(e.el.object3D,!0).length==0&&(e.el.getAttribute("visible")?e.el.setAttribute("visible",!1):(e.el.setAttribute("visible",!0),e.position_control_from_camera()))})})},update:function(e){var i=this;this.video_selector=this.data.src,this.video_el=document.querySelector(this.video_selector),this.video_el.paused?this.play_image.setAttribute("src",i.play_image_src):this.play_image.setAttribute("src",i.pause_image_src),this.video_el&&this.endedListener&&this.video_el.removeEventListener("ended",this.endedListener),this.endedListener=function(){i.play_image.setAttribute("src",i.play_image_src)},this.video_el.addEventListener("ended",this.endedListener),this.video_el&&this.pauseListener&&this.video_el.removeEventListener("pause",this.pauseListener),this.pauseListener=function(){i.play_image.setAttribute("src",i.play_image_src)},this.video_el.addEventListener("pause",this.pauseListener),this.video_el&&this.playingListener&&this.video_el.removeEventListener("playing",this.playingListener),this.playingListener=function(){i.play_image.setAttribute("src",i.pause_image_src)},this.video_el.addEventListener("playing",this.playingListener),this.position_control_from_camera(),this.el.setAttribute("visible",!0),this.bar.setAttribute("height",this.data.size/4),this.bar.setAttribute("width",this.data.size),this.bar.setAttribute("position","0.0 0.0 0"),this.play_image.setAttribute("height",this.data.size/4),this.play_image.setAttribute("width",this.data.size/4),this.play_image.setAttribute("position",-this.data.size/2*1.4+" 0 0")},remove:function(){},tick:function(e){if(typeof this.last_time>"u"||e-this.last_time>250){if(this.video_el.readyState>0){const n=Math.floor(this.video_el.currentTime/60),l=Math.floor(this.video_el.currentTime%60),u=n<10?"0"+n:n,p=l<10?"0"+l:l,d=Math.floor(this.video_el.duration/60),h=Math.floor(this.video_el.duration%60),v=d<10?"0"+d:d,f=h<10?"0"+h:h;var i=u+":"+p+" / "+v+":"+f,a=this.bar_canvas.width/this.video_el.duration;if(this.video_el.buffered.length>0){this.current_step=Math.round(this.video_el.currentTime/this.video_el.duration*this.bar_steps);var t=this.context;if(t.fillStyle=this.data.backgroundColor,t.fillRect(0,0,this.bar_canvas.width,this.bar_canvas.height),t.font=this.data.timeTextFont,t.fillStyle="white",t.textAlign="center",t.fillText(i,this.bar_canvas.width/2,this.bar_canvas.height*.65),this.video_el.seeking)t.font=this.data.statusTextFont,t.fillStyle=this.data.textColor,t.textAlign="end",t.fillText("Seeking",this.bar_canvas.width*.95,this.bar_canvas.height*.6);else{var s=this.video_el.buffered.end(this.video_el.buffered.length-1)/this.video_el.duration*100;t.font=this.data.statusTextFont,t.fillStyle=this.data.textColor,t.textAlign="end",t.fillText(s.toFixed(0)+"% loaded",this.bar_canvas.width*.95,this.bar_canvas.height*.6)}t.fillStyle=this.data.textColor,t.font=this.data.infoTextFont,t.textAlign="center",t.fillText(this.data.infoTextTop,this.bar_canvas.width/2,this.bar_canvas.height*.8),t.fillText(this.data.infoTextBottom,this.bar_canvas.width/2,this.bar_canvas.height*.95);for(var r=0;r<this.video_el.buffered.length;r++){var o=this.video_el.buffered.start(r)*a,c=this.video_el.buffered.end(r)*a,_=c-o;t.fillStyle="grey",t.fillRect(o,0,_,this.bar_canvas.height/3)}t.fillStyle=this.data.barColor,t.fillRect(0,0,this.video_el.currentTime/this.video_el.duration*this.bar_canvas.width,this.bar_canvas.height/3)}this.bar.object3D.children.length>0&&(this.bar.object3D.children[0].material.map===null&&(this.bar.object3D.children[0].material=new THREE.MeshBasicMaterial,this.bar.object3D.children[0].material.map=this.texture),this.texture.needsUpdate=!0)}this.last_time=e}},pause:function(){},play:function(){}});if(typeof AFRAME>"u")throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerSystem("style-video-controls",{init:function(){document.querySelector("a-scene").addEventListener("loaded",e=>{const i=document.querySelector("[video-controls]"),a=i.components["video-controls"],t=getComputedStyle(i),s=t.getPropertyValue("--theme-blue"),r=t.getPropertyValue("--theme-tan"),o=t.getPropertyValue("--theme-white");t.getPropertyValue("--theme-black"),a.data.infoTextTop="Look + click on play or bar ",a.data.infoTextBottom="",a.data.backgroundColor=s,a.data.barColor=r,a.data.textColor=o,a.data.infoTextFont="500 2em Raleway",a.data.statusTextFont="800 2em Raleway",a.data.timeTextFont="800 3em Raleway"})}});
