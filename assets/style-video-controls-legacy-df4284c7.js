System.register([],(function(e,t){"use strict";return{execute:function(){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");if(AFRAME.registerComponent("video-controls",{schema:{src:{type:"string"},size:{type:"number",default:1},distance:{type:"number",default:2},backgroundColor:{default:"black"},barColor:{default:"red"},textColor:{default:"yellow"},infoTextBottom:{default:"Double-click outside player to hide or show it."},infoTextTop:{default:"Look+click on play or bar. Space bar and arrows also work."},infoTextFont:{default:"35px Helvetica Neue"},statusTextFont:{default:"30px Helvetica Neue"},timeTextFont:{default:"70px Helvetica Neue"}},position_time_from_steps:function(){var e=this.current_step/this.bar_steps;this.video_el.readyState>0&&(this.video_el.currentTime=e*this.video_el.duration)},position_control_from_camera:function(){var e=this,t=e.el.sceneEl.camera;if(t){var i=t.el.getAttribute("rotation").y;e.y_position=1,e.x_position=-e.data.distance*Math.sin(i*Math.PI/180),e.z_position=-e.data.distance*Math.cos(i*Math.PI/180),e.el.setAttribute("position",[e.x_position,e.y_position,e.z_position].join(" "));let a=new THREE.Vector3;t.getWorldPosition(a),this.el.object3D.lookAt(a)}},init:function(){var e=this;this.bar_steps=10,this.current_step=0,this.el.setAttribute("visible",!0),e.play_image_src=document.getElementById("video-play-image")?"#video-play-image":"https://res.cloudinary.com/dxbh0pppv/image/upload/c_scale,h_512,q_10/v1471016296/play_wvmogo.png",e.pause_image_src=document.getElementById("video-pause-image")?"#video-pause-image":"https://res.cloudinary.com/dxbh0pppv/image/upload/c_scale,h_512,q_25/v1471016296/pause_ndega5.png",this.play_image=document.createElement("a-image"),this.play_image.classList.add("clickable"),this.bar_canvas=document.createElement("canvas"),this.bar_canvas.setAttribute("id","video_player_canvas"),this.bar_canvas.width=1024,this.bar_canvas.height=256,this.bar_canvas.style.display="none",this.context=this.bar_canvas.getContext("2d"),this.texture=new THREE.Texture(this.bar_canvas),this.play_image.addEventListener("click",(function(t){e.video_el.paused?(this.setAttribute("src",e.pause_image_src),e.video_el.play()):(this.setAttribute("src",e.play_image_src),e.video_el.pause()),t.stopPropagation(),t.preventDefault()})),window.addEventListener("keyup",(function(t){switch(t.keyCode){case 32:e.play_image.dispatchEvent(new Event("click"));break;case 37:e.current_step=0,e.position_time_from_steps();break;case 39:e.current_step=e.bar_steps,e.position_time_from_steps();break;case 38:e.current_step=e.current_step<e.bar_steps?e.current_step+1:e.current_step,e.position_time_from_steps();break;case 40:e.current_step=e.current_step>0?e.current_step-1:e.current_step,e.position_time_from_steps()}}),!1),this.bar=document.createElement("a-plane"),this.bar.addEventListener("click",(function(t){var i=document.querySelector("a-cursor").components.raycaster.raycaster.intersectObject(this.object3D,!0)[0].point,a=this.object3D.worldToLocal(i).x/e.data.size+.5;e.current_step=Math.round(a*e.bar_steps),e.video_el.readyState>0&&(e.video_el.currentTime=a*e.video_el.duration),t.stopPropagation(),t.preventDefault()})),this.el.appendChild(this.bar_canvas),this.el.appendChild(this.play_image),this.el.appendChild(this.bar),this.el.sceneEl.addEventListener("loaded",(function(){e.position_control_from_camera(),this.addEventListener("dblclick",(function(){0==document.querySelector("a-cursor").components.raycaster.raycaster.intersectObject(e.el.object3D,!0).length&&(e.el.getAttribute("visible")?e.el.setAttribute("visible",!1):(e.el.setAttribute("visible",!0),e.position_control_from_camera()))}))}))},update:function(e){var t=this;this.video_selector=this.data.src,this.video_el=document.querySelector(this.video_selector),this.video_el.paused?this.play_image.setAttribute("src",t.play_image_src):this.play_image.setAttribute("src",t.pause_image_src),this.video_el&&this.endedListener&&this.video_el.removeEventListener("ended",this.endedListener),this.endedListener=function(){t.play_image.setAttribute("src",t.play_image_src)},this.video_el.addEventListener("ended",this.endedListener),this.video_el&&this.pauseListener&&this.video_el.removeEventListener("pause",this.pauseListener),this.pauseListener=function(){t.play_image.setAttribute("src",t.play_image_src)},this.video_el.addEventListener("pause",this.pauseListener),this.video_el&&this.playingListener&&this.video_el.removeEventListener("playing",this.playingListener),this.playingListener=function(){t.play_image.setAttribute("src",t.pause_image_src)},this.video_el.addEventListener("playing",this.playingListener),this.position_control_from_camera(),this.el.setAttribute("visible",!0),this.bar.setAttribute("height",this.data.size/4),this.bar.setAttribute("width",this.data.size),this.bar.setAttribute("position","0.0 0.0 0"),this.play_image.setAttribute("height",this.data.size/4),this.play_image.setAttribute("width",this.data.size/4),this.play_image.setAttribute("position",-this.data.size/2*1.4+" 0 0")},remove:function(){},tick:function(e){if(void 0===this.last_time||e-this.last_time>250){if(this.video_el.readyState>0){const e=Math.floor(this.video_el.currentTime/60),l=Math.floor(this.video_el.currentTime%60),d=e<10?"0"+e:e,h=l<10?"0"+l:l,c=Math.floor(this.video_el.duration/60),_=Math.floor(this.video_el.duration%60);var t=d+":"+h+" / "+(c<10?"0"+c:c)+":"+(_<10?"0"+_:_),i=this.bar_canvas.width/this.video_el.duration;if(this.video_el.buffered.length>0){this.current_step=Math.round(this.video_el.currentTime/this.video_el.duration*this.bar_steps);var a=this.context;if(a.fillStyle=this.data.backgroundColor,a.fillRect(0,0,this.bar_canvas.width,this.bar_canvas.height),a.font=this.data.timeTextFont,a.fillStyle="white",a.textAlign="center",a.fillText(t,this.bar_canvas.width/2,.65*this.bar_canvas.height),this.video_el.seeking)a.font=this.data.statusTextFont,a.fillStyle=this.data.textColor,a.textAlign="end",a.fillText("Seeking",.95*this.bar_canvas.width,.6*this.bar_canvas.height);else{var s=this.video_el.buffered.end(this.video_el.buffered.length-1)/this.video_el.duration*100;a.font=this.data.statusTextFont,a.fillStyle=this.data.textColor,a.textAlign="end",a.fillText(s.toFixed(0)+"% loaded",.95*this.bar_canvas.width,.6*this.bar_canvas.height)}a.fillStyle=this.data.textColor,a.font=this.data.infoTextFont,a.textAlign="center",a.fillText(this.data.infoTextTop,this.bar_canvas.width/2,.8*this.bar_canvas.height),a.fillText(this.data.infoTextBottom,this.bar_canvas.width/2,.95*this.bar_canvas.height);for(var r=0;r<this.video_el.buffered.length;r++){var o=this.video_el.buffered.start(r)*i,n=this.video_el.buffered.end(r)*i-o;a.fillStyle="grey",a.fillRect(o,0,n,this.bar_canvas.height/3)}a.fillStyle=this.data.barColor,a.fillRect(0,0,this.video_el.currentTime/this.video_el.duration*this.bar_canvas.width,this.bar_canvas.height/3)}this.bar.object3D.children.length>0&&(null===this.bar.object3D.children[0].material.map&&(this.bar.object3D.children[0].material=new THREE.MeshBasicMaterial,this.bar.object3D.children[0].material.map=this.texture),this.texture.needsUpdate=!0)}this.last_time=e}},pause:function(){},play:function(){}}),"undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerSystem("style-video-controls",{init:function(){document.querySelector("a-scene").addEventListener("loaded",(e=>{const t=document.querySelector("[video-controls]"),i=t.components["video-controls"],a=getComputedStyle(t),s=a.getPropertyValue("--theme-blue"),r=a.getPropertyValue("--theme-tan"),o=a.getPropertyValue("--theme-white");a.getPropertyValue("--theme-black"),i.data.infoTextTop="Look + click on play or bar ",i.data.infoTextBottom="",i.data.backgroundColor=s,i.data.barColor=r,i.data.textColor=o,i.data.infoTextFont="500 2em Raleway",i.data.statusTextFont="800 2em Raleway",i.data.timeTextFont="800 3em Raleway"}))}})}}}));
