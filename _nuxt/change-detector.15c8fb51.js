var o=Object.defineProperty;var m=(i,e,t)=>e in i?o(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var n=(i,e,t)=>(m(i,typeof e!="symbol"?e+"":e,t),t);import{c as l,B as u}from"./component.decorator.a66a1cbe.js";import"./aframe-master.5ce7d00f.js";import"./test-helpers.473cda21.js";var c=Object.defineProperty,v=Object.getOwnPropertyDescriptor,g=(i,e,t,a)=>{for(var s=a>1?void 0:a?v(e,t):e,d=i.length-1,r;d>=0;d--)(r=i[d])&&(s=(a?r(e,t,s):r(s))||s);return a&&s&&c(e,t,s),s},h;let f=(h=class extends u{constructor(){super(...arguments);n(this,"isArMode",!1);n(this,"mutationObserver");n(this,"bufferTimeout");n(this,"bufferTimeoutEntities",[])}init(){var e,t;this.data.enterVr&&((e=this.el.sceneEl)==null||e.addEventListener("enter-vr",()=>{var a;(a=this.el.sceneEl)!=null&&a.is("ar-mode")&&(this.isArMode=!0,this.emitChanged())})),this.data.exitVr&&((t=this.el.sceneEl)==null||t.addEventListener("exit-vr",()=>{this.isArMode=!1,this.emitChanged()})),this.mutationObserver=new MutationObserver((a,s)=>{a.forEach(d=>{if(d.type=="childList"){this.bufferTimeout||(this.bufferTimeout=setTimeout(()=>{for(const r of this.bufferTimeoutEntities)this.tryTrackEntity(r);this.data.elemTreeChanged&&this.emitChanged(),this.bufferTimeout=void 0,this.bufferTimeoutEntities=[]},0));for(const r of this.bufferTimeoutEntities)if(r==d.target)return;this.bufferTimeoutEntities.push(d.target)}})}),this.tryTrackEntity(this.el),this.mutationObserver.observe(this.el,{childList:!0,subtree:this.data.recursive})}tryTrackEntity(e){e.hasAttribute("change-detector-tracked")||(e.setAttribute("change-detector-tracked",!0),e.hasLoaded||e.addEventListener("loaded",()=>this.emitChanged()),this.data.object3DSet&&e.addEventListener("object3dset",()=>{this.emitChanged()}),this.data.play&&e.addEventListener("play",()=>this.emitChanged()),this.data.pause&&e.addEventListener("pause",()=>this.emitChanged()),this.data.componentChanged&&e.addEventListener("componentchanged",()=>this.emitChanged()),this.data.componentInitialized&&e.addEventListener("componentinitialized",()=>this.emitChanged()),this.data.componentRemoved&&e.addEventListener("componentremoved",()=>this.emitChanged()),this.data.schemaChanged&&e.addEventListener("schemachanged",()=>this.emitChanged()),this.data.stateAdded&&e.addEventListener("stateadded",()=>this.emitChanged()),this.data.stateRemoved&&e.addEventListener("stateremoved",()=>this.emitChanged()))}emitChanged(){this.el.emit(`detectorchanged__${this.id}`)}remove(){var e;(e=this.mutationObserver)==null||e.disconnect()}},n(h,"schema",{recursive:{default:!1},enterVr:{default:!1},exitVr:{default:!1},elemTreeChanged:{default:!1},componentChanged:{default:!1},componentInitialized:{default:!1},componentRemoved:{default:!1},object3DSet:{default:!1},pause:{default:!1},play:{default:!1},stateAdded:{default:!1},stateRemoved:{default:!1},schemaChanged:{default:!1}}),n(h,"multiple",!0),h);f=g([l("change-detector")],f);
