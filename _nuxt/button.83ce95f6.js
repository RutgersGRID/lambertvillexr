var Fa=Object.defineProperty;var Ca=(we,se,ge)=>se in we?Fa(we,se,{enumerable:!0,configurable:!0,writable:!0,value:ge}):we[se]=ge;var nt=(we,se,ge)=>(Ca(we,typeof se!="symbol"?se+"":se,ge),ge);import{c as Rr,B as Dr}from"./component.decorator.a66a1cbe.js";import{b as Mr}from"./aframe-master.5ce7d00f.js";import"./test-helpers.473cda21.js";import{d as at}from"./document.6adaffbf.js";var Ma=Object.defineProperty,Ra=Object.getOwnPropertyDescriptor,Da=(we,se,ge,Ue)=>{for(var Ee=Ue>1?void 0:Ue?Ra(se,ge):se,Be=we.length-1,ze;Be>=0;Be--)(ze=we[Be])&&(Ee=(Ue?ze(se,ge,Ee):ze(Ee))||Ee);return Ue&&Ee&&Ma(se,ge,Ee),Ee},Fr;let xn=(Fr=class extends Dr{init(){this.update()}update(){this.el.hasAttribute("material")&&this.el.setAttribute("material","opacity",this.data.opacity);const we=se=>{Array.from(se.children).forEach(Ue=>{if(Ue!=this.el&&Ue.hasAttribute&&Ue.hasAttribute("group-opacity")&&Ue.getAttribute("group-opacity").inherit){Ue.setAttribute("group-opacity","opacity",this.data.opacity);return}Ue.hasAttribute&&Ue.hasAttribute("material")&&Ue.setAttribute("material","opacity",this.data.opacity),we(Ue)})};we(this.el)}},nt(Fr,"schema",{opacity:{default:1},inherit:{default:!0}}),Fr);xn=Da([Rr("group-opacity")],xn);var Oa=Object.defineProperty,Pa=Object.getOwnPropertyDescriptor,Ga=(we,se,ge,Ue)=>{for(var Ee=Ue>1?void 0:Ue?Pa(se,ge):se,Be=we.length-1,ze;Be>=0;Be--)(ze=we[Be])&&(Ee=(Ue?ze(se,ge,Ee):ze(Ee))||Ee);return Ue&&Ee&&Oa(se,ge,Ee),Ee},Cr;let wn=(Cr=class extends Dr{init(){this.update()}update(){this.el.hasAttribute("material")&&this.el.setAttribute("material","color",this.data.color);const we=se=>{se.hasAttribute("material")&&se.setAttribute("material","color",this.data.color),Array.from(se.children).forEach(ge=>{if(ge!=this.el&&ge.hasAttribute&&ge.hasAttribute("group-color")&&ge.getAttribute("group-color").inherit){ge.setAttribute("group-color","color",this.data.color);return}we(ge)})};we(this.el)}},nt(Cr,"schema",{color:{type:"color"},inherit:{default:!0}}),Cr);wn=Ga([Rr("group-color")],wn);(function(we,se){function ge(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}function Ue(l){if(l&&l.__esModule)return l;var r=Object.create(null);return l&&Object.keys(l).forEach(function(d){if(d!=="default"){var c=Object.getOwnPropertyDescriptor(l,d);Object.defineProperty(r,d,c.get?c:{enumerable:!0,get:function(){return l[d]}})}}),r.default=l,Object.freeze(r)}var Ee=Ue(we),Be=ge(se);function ze(){var l=Object.create(null);function r(t,e){var o=t.id,a=t.name,n=t.dependencies;n===void 0&&(n=[]);var i=t.init;i===void 0&&(i=function(){});var s=t.getTransferables;if(s===void 0&&(s=null),!l[o])try{n=n.map(function(u){return u&&u.isWorkerModule&&(r(u,function(h){if(h instanceof Error)throw h}),u=l[u.id].value),u}),i=c("<"+a+">.init",i),s&&(s=c("<"+a+">.getTransferables",s));var f=null;typeof i=="function"?f=i.apply(void 0,n):console.error("worker module init function failed to rehydrate"),l[o]={id:o,value:f,getTransferables:s},e(f)}catch(u){u&&u.noLog||console.error(u),e(u)}}function d(t,e){var o,a=t.id,n=t.args;(!l[a]||typeof l[a].value!="function")&&e(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var i=(o=l[a]).value.apply(o,n);i&&typeof i.then=="function"?i.then(s,function(f){return e(f instanceof Error?f:new Error(""+f))}):s(i)}catch(f){e(f)}function s(f){try{var u=l[a].getTransferables&&l[a].getTransferables(f);(!u||!Array.isArray(u)||!u.length)&&(u=void 0),e(f,u)}catch(h){console.error(h),e(h)}}}function c(t,e){var o=void 0;self.troikaDefine=function(n){return o=n};var a=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(a)}catch(n){console.error(n)}return URL.revokeObjectURL(a),delete self.troikaDefine,o}self.addEventListener("message",function(t){var e=t.data,o=e.messageId,a=e.action,n=e.data;try{a==="registerModule"&&r(n,function(i){i instanceof Error?postMessage({messageId:o,success:!1,error:i.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof i=="function"}})}),a==="callModule"&&d(n,function(i,s){i instanceof Error?postMessage({messageId:o,success:!1,error:i.message}):postMessage({messageId:o,success:!0,result:i},s||void 0)})}catch(i){postMessage({messageId:o,success:!1,error:i.stack})}})}function Fn(l){var r=function(){for(var d=[],c=arguments.length;c--;)d[c]=arguments[c];return r._getInitResult().then(function(t){if(typeof t=="function")return t.apply(void 0,d);throw new Error("Worker module function was called but `init` did not return a callable function")})};return r._getInitResult=function(){var d=l.dependencies,c=l.init;d=Array.isArray(d)?d.map(function(e){return e&&e._getInitResult?e._getInitResult():e}):[];var t=Promise.all(d).then(function(e){return c.apply(null,e)});return r._getInitResult=function(){return t},t},r}var Or=function(){var l=!1;if(typeof window<"u"&&typeof window.document<"u")try{var r=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));r.terminate(),l=!0}catch(d){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+d.message+"]")}return Or=function(){return l},l},Cn=0,Mn=0,tr=!1,pt=Object.create(null),gt=Object.create(null),rr=Object.create(null);function mt(l){if((!l||typeof l.init!="function")&&!tr)throw new Error("requires `options.init` function");var r=l.dependencies,d=l.init,c=l.getTransferables,t=l.workerId;if(!Or())return Fn(l);t==null&&(t="#default");var e="workerModule"+ ++Cn,o=l.name||e,a=null;r=r&&r.map(function(i){return typeof i=="function"&&!i.workerModuleData&&(tr=!0,i=mt({workerId:t,name:"<"+o+"> function dependency: "+i.name,init:`function(){return (
`+Dt(i)+`
)}`}),tr=!1),i&&i.workerModuleData&&(i=i.workerModuleData),i});function n(){for(var i=[],s=arguments.length;s--;)i[s]=arguments[s];if(!a){a=Pr(t,"registerModule",n.workerModuleData);var f=function(){a=null,gt[t].delete(f)};(gt[t]||(gt[t]=new Set)).add(f)}return a.then(function(u){var h=u.isCallable;if(h)return Pr(t,"callModule",{id:e,args:i});throw new Error("Worker module function was called but `init` did not return a callable function")})}return n.workerModuleData={isWorkerModule:!0,id:e,name:o,dependencies:r,init:Dt(d),getTransferables:c&&Dt(c)},n}function Rn(l){gt[l]&&gt[l].forEach(function(r){r()}),pt[l]&&(pt[l].terminate(),delete pt[l])}function Dt(l){var r=l.toString();return!/^function/.test(r)&&/^\w+\s*\(/.test(r)&&(r="function "+r),r}function Dn(l){var r=pt[l];if(!r){var d=Dt(ze);r=pt[l]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+l.replace(/\*/g,"")+` **/

;(`+d+")()"],{type:"application/javascript"}))),r.onmessage=function(c){var t=c.data,e=t.messageId,o=rr[e];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete rr[e],o(t)}}return r}function Pr(l,r,d){return new Promise(function(c,t){var e=++Mn;rr[e]=function(o){o.success?c(o.result):t(new Error("Error in worker "+r+" call: "+o.error))},Dn(l).postMessage({messageId:e,action:r,data:d})})}function Gr(){var l=function(r){function d(D,W,v,E,G,P,F,I){var A=1-F;I.x=A*A*D+2*A*F*v+F*F*G,I.y=A*A*W+2*A*F*E+F*F*P}function c(D,W,v,E,G,P,F,I,A,R){var z=1-A;R.x=z*z*z*D+3*z*z*A*v+3*z*A*A*G+A*A*A*F,R.y=z*z*z*W+3*z*z*A*E+3*z*A*A*P+A*A*A*I}function t(D,W){for(var v=/([MLQCZ])([^MLQCZ]*)/g,E,G,P,F,I;E=v.exec(D);){var A=E[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(R){return parseFloat(R)});switch(E[1]){case"M":F=G=A[0],I=P=A[1];break;case"L":(A[0]!==F||A[1]!==I)&&W("L",F,I,F=A[0],I=A[1]);break;case"Q":{W("Q",F,I,F=A[2],I=A[3],A[0],A[1]);break}case"C":{W("C",F,I,F=A[4],I=A[5],A[0],A[1],A[2],A[3]);break}case"Z":(F!==G||I!==P)&&W("L",F,I,G,P);break}}}function e(D,W,v){v===void 0&&(v=16);var E={x:0,y:0};t(D,function(G,P,F,I,A,R,z,q,V){switch(G){case"L":W(P,F,I,A);break;case"Q":{for(var M=P,ve=F,he=1;he<v;he++)d(P,F,R,z,I,A,he/(v-1),E),W(M,ve,E.x,E.y),M=E.x,ve=E.y;break}case"C":{for(var H=P,$=F,fe=1;fe<v;fe++)c(P,F,R,z,q,V,I,A,fe/(v-1),E),W(H,$,E.x,E.y),H=E.x,$=E.y;break}}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,i={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(D,W){var v=D.getContext?D.getContext("webgl",i):D,E=n.get(v);if(!E){let z=function(H){var $=P[H];if(!$&&($=P[H]=v.getExtension(H),!$))throw new Error(H+" not supported");return $},q=function(H,$){var fe=v.createShader($);return v.shaderSource(fe,H),v.compileShader(fe),fe},V=function(H,$,fe,L){if(!F[H]){var te={},Y={},O=v.createProgram();v.attachShader(O,q($,v.VERTEX_SHADER)),v.attachShader(O,q(fe,v.FRAGMENT_SHADER)),v.linkProgram(O),F[H]={program:O,transaction:function(Q){v.useProgram(O),Q({setUniform:function(J,be){for(var me=[],ee=arguments.length-2;ee-- >0;)me[ee]=arguments[ee+2];var ce=Y[be]||(Y[be]=v.getUniformLocation(O,be));v["uniform"+J].apply(v,[ce].concat(me))},setAttribute:function(J,be,me,ee,ce){var ye=te[J];ye||(ye=te[J]={buf:v.createBuffer(),loc:v.getAttribLocation(O,J),data:null}),v.bindBuffer(v.ARRAY_BUFFER,ye.buf),v.vertexAttribPointer(ye.loc,be,v.FLOAT,!1,0,0),v.enableVertexAttribArray(ye.loc),G?v.vertexAttribDivisor(ye.loc,ee):z("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(ye.loc,ee),ce!==ye.data&&(v.bufferData(v.ARRAY_BUFFER,ce,me),ye.data=ce)}})}}}F[H].transaction(L)},M=function(H,$){A++;try{v.activeTexture(v.TEXTURE0+A);var fe=I[H];fe||(fe=I[H]=v.createTexture(),v.bindTexture(v.TEXTURE_2D,fe),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST)),v.bindTexture(v.TEXTURE_2D,fe),$(fe,A)}finally{A--}},ve=function(H,$,fe){var L=v.createFramebuffer();R.push(L),v.bindFramebuffer(v.FRAMEBUFFER,L),v.activeTexture(v.TEXTURE0+$),v.bindTexture(v.TEXTURE_2D,H),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,H,0);try{fe(L)}finally{v.deleteFramebuffer(L),v.bindFramebuffer(v.FRAMEBUFFER,R[--R.length-1]||null)}},he=function(){P={},F={},I={},A=-1,R.length=0};var G=typeof WebGL2RenderingContext<"u"&&v instanceof WebGL2RenderingContext,P={},F={},I={},A=-1,R=[];v.canvas.addEventListener("webglcontextlost",function(H){he(),H.preventDefault()},!1),n.set(v,E={gl:v,isWebGL2:G,getExtension:z,withProgram:V,withTexture:M,withTextureFramebuffer:ve,handleContextLoss:he})}W(E)}function f(D,W,v,E,G,P,F,I){F===void 0&&(F=15),I===void 0&&(I=null),s(D,function(A){var R=A.gl,z=A.withProgram,q=A.withTexture;q("copy",function(V,M){R.texImage2D(R.TEXTURE_2D,0,R.RGBA,G,P,0,R.RGBA,R.UNSIGNED_BYTE,W),z("copy",o,a,function(ve){var he=ve.setUniform,H=ve.setAttribute;H("aUV",2,R.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),he("1i","image",M),R.bindFramebuffer(R.FRAMEBUFFER,I||null),R.disable(R.BLEND),R.colorMask(F&8,F&4,F&2,F&1),R.viewport(v,E,G,P),R.scissor(v,E,G,P),R.drawArrays(R.TRIANGLES,0,3)})})})}function u(D,W,v){var E=D.width,G=D.height;s(D,function(P){var F=P.gl,I=new Uint8Array(E*G*4);F.readPixels(0,0,E,G,F.RGBA,F.UNSIGNED_BYTE,I),D.width=W,D.height=v,f(F,I,0,0,E,G)})}var h=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:f,resizeWebGLCanvasWithoutClearing:u});function m(D,W,v,E,G,P){P===void 0&&(P=1);var F=new Uint8Array(D*W),I=E[2]-E[0],A=E[3]-E[1],R=[];e(v,function(H,$,fe,L){R.push({x1:H,y1:$,x2:fe,y2:L,minX:Math.min(H,fe),minY:Math.min($,L),maxX:Math.max(H,fe),maxY:Math.max($,L)})}),R.sort(function(H,$){return H.maxX-$.maxX});for(var z=0;z<D;z++)for(var q=0;q<W;q++){var V=ve(E[0]+I*(z+.5)/D,E[1]+A*(q+.5)/W),M=Math.pow(1-Math.abs(V)/G,P)/2;V<0&&(M=1-M),M=Math.max(0,Math.min(255,Math.round(M*255))),F[q*D+z]=M}return F;function ve(H,$){for(var fe=1/0,L=1/0,te=R.length;te--;){var Y=R[te];if(Y.maxX+L<=H)break;if(H+L>Y.minX&&$-L<Y.maxY&&$+L>Y.minY){var O=k(H,$,Y.x1,Y.y1,Y.x2,Y.y2);O<fe&&(fe=O,L=Math.sqrt(fe))}}return he(H,$)&&(L=-L),L}function he(H,$){for(var fe=0,L=R.length;L--;){var te=R[L];if(te.maxX<=H)break;var Y=te.y1>$!=te.y2>$&&H<(te.x2-te.x1)*($-te.y1)/(te.y2-te.y1)+te.x1;Y&&(fe+=te.y1<te.y2?1:-1)}return fe!==0}}function y(D,W,v,E,G,P,F,I,A,R){P===void 0&&(P=1),I===void 0&&(I=0),A===void 0&&(A=0),R===void 0&&(R=0),g(D,W,v,E,G,P,F,null,I,A,R)}function g(D,W,v,E,G,P,F,I,A,R,z){P===void 0&&(P=1),A===void 0&&(A=0),R===void 0&&(R=0),z===void 0&&(z=0);for(var q=m(D,W,v,E,G,P),V=new Uint8Array(q.length*4),M=0;M<q.length;M++)V[M*4+z]=q[M];f(F,V,A,R,D,W,1<<3-z,I)}function k(D,W,v,E,G,P){var F=G-v,I=P-E,A=F*F+I*I,R=A?Math.max(0,Math.min(1,((D-v)*F+(W-E)*I)/A)):0,z=D-(v+R*F),q=W-(E+R*I);return z*z+q*q}var p=Object.freeze({__proto__:null,generate:m,generateIntoCanvas:y,generateIntoFramebuffer:g}),T="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",w="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",_="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",S=new Float32Array([0,0,2,0,0,2]),x=null,U=!1,X={},K=new WeakMap;function ne(D){if(!U&&!j(D))throw new Error("WebGL generation not supported")}function b(D,W,v,E,G,P,F){if(P===void 0&&(P=1),F===void 0&&(F=null),!F&&(F=x,!F)){var I=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof at<"u"?at.createElement("canvas"):null;if(!I)throw new Error("OffscreenCanvas or DOM canvas not supported");F=x=I.getContext("webgl",{depth:!1})}ne(F);var A=new Uint8Array(D*W*4);s(F,function(V){var M=V.gl,ve=V.withTexture,he=V.withTextureFramebuffer;ve("readable",function(H,$){M.texImage2D(M.TEXTURE_2D,0,M.RGBA,D,W,0,M.RGBA,M.UNSIGNED_BYTE,null),he(H,$,function(fe){C(D,W,v,E,G,P,M,fe,0,0,0),M.readPixels(0,0,D,W,M.RGBA,M.UNSIGNED_BYTE,A)})})});for(var R=new Uint8Array(D*W),z=0,q=0;z<A.length;z+=4)R[q++]=A[z];return R}function B(D,W,v,E,G,P,F,I,A,R){P===void 0&&(P=1),I===void 0&&(I=0),A===void 0&&(A=0),R===void 0&&(R=0),C(D,W,v,E,G,P,F,null,I,A,R)}function C(D,W,v,E,G,P,F,I,A,R,z){P===void 0&&(P=1),A===void 0&&(A=0),R===void 0&&(R=0),z===void 0&&(z=0),ne(F);var q=[];e(v,function(V,M,ve,he){q.push(V,M,ve,he)}),q=new Float32Array(q),s(F,function(V){var M=V.gl,ve=V.isWebGL2,he=V.getExtension,H=V.withProgram,$=V.withTexture,fe=V.withTextureFramebuffer,L=V.handleContextLoss;if($("rawDistances",function(te,Y){(D!==te._lastWidth||W!==te._lastHeight)&&M.texImage2D(M.TEXTURE_2D,0,M.RGBA,te._lastWidth=D,te._lastHeight=W,0,M.RGBA,M.UNSIGNED_BYTE,null),H("main",T,w,function(O){var ae=O.setAttribute,Q=O.setUniform,re=!ve&&he("ANGLE_instanced_arrays"),J=!ve&&he("EXT_blend_minmax");ae("aUV",2,M.STATIC_DRAW,0,S),ae("aLineSegment",4,M.DYNAMIC_DRAW,1,q),Q.apply(void 0,["4f","uGlyphBounds"].concat(E)),Q("1f","uMaxDistance",G),Q("1f","uExponent",P),fe(te,Y,function(be){M.enable(M.BLEND),M.colorMask(!0,!0,!0,!0),M.viewport(0,0,D,W),M.scissor(0,0,D,W),M.blendFunc(M.ONE,M.ONE),M.blendEquationSeparate(M.FUNC_ADD,ve?M.MAX:J.MAX_EXT),M.clear(M.COLOR_BUFFER_BIT),ve?M.drawArraysInstanced(M.TRIANGLES,0,3,q.length/4):re.drawArraysInstancedANGLE(M.TRIANGLES,0,3,q.length/4)})}),H("post",o,_,function(O){O.setAttribute("aUV",2,M.STATIC_DRAW,0,S),O.setUniform("1i","tex",Y),M.bindFramebuffer(M.FRAMEBUFFER,I),M.disable(M.BLEND),M.colorMask(z===0,z===1,z===2,z===3),M.viewport(A,R,D,W),M.scissor(A,R,D,W),M.drawArrays(M.TRIANGLES,0,3)})}),M.isContextLost())throw L(),new Error("webgl context lost")})}function j(D){var W=!D||D===x?X:D.canvas||D,v=K.get(W);if(v===void 0){U=!0;var E=null;try{var G=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],P=b(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,D);v=P&&G.length===P.length&&P.every(function(F,I){return F===G[I]}),v||(E="bad trial run results",console.info(G,P))}catch(F){v=!1,E=F.message}E&&console.warn("WebGL SDF generation not supported:",E),U=!1,K.set(W,v)}return v}var N=Object.freeze({__proto__:null,generate:b,generateIntoCanvas:B,generateIntoFramebuffer:C,isSupported:j});function le(D,W,v,E,G,P){G===void 0&&(G=Math.max(E[2]-E[0],E[3]-E[1])/2),P===void 0&&(P=1);try{return b.apply(N,arguments)}catch(F){return console.info("WebGL SDF generation failed, falling back to JS",F),m.apply(p,arguments)}}function ie(D,W,v,E,G,P,F,I,A,R){G===void 0&&(G=Math.max(E[2]-E[0],E[3]-E[1])/2),P===void 0&&(P=1),I===void 0&&(I=0),A===void 0&&(A=0),R===void 0&&(R=0);try{return B.apply(N,arguments)}catch(z){return console.info("WebGL SDF generation failed, falling back to JS",z),y.apply(p,arguments)}}return r.forEachPathCommand=t,r.generate=le,r.generateIntoCanvas=ie,r.javascript=p,r.pathToLineSegments=e,r.webgl=N,r.webglUtils=h,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}function On(){var l=function(r){var d={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},c={},t={};c.L=1,t[1]="L",Object.keys(d).forEach(function(L,te){c[L]=1<<te+1,t[c[L]]=L}),Object.freeze(c);var e=c.LRI|c.RLI|c.FSI,o=c.L|c.R|c.AL,a=c.B|c.S|c.WS|c.ON|c.FSI|c.LRI|c.RLI|c.PDI,n=c.BN|c.RLE|c.LRE|c.RLO|c.LRO|c.PDF,i=c.S|c.WS|c.B|e|c.PDI|n,s=null;function f(){if(!s){s=new Map;var L=function(Y){if(d.hasOwnProperty(Y)){var O=0;d[Y].split(",").forEach(function(ae){var Q=ae.split("+"),re=Q[0],J=Q[1];re=parseInt(re,36),J=J?parseInt(J,36):0,s.set(O+=re,c[Y]);for(var be=0;be<J;be++)s.set(++O,c[Y])})}};for(var te in d)L(te)}}function u(L){return f(),s.get(L.codePointAt(0))||c.L}function h(L){return t[u(L)]}var m={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function y(L,te){var Y=36,O=0,ae=new Map,Q=te&&new Map,re;return L.split(",").forEach(function J(be){if(be.indexOf("+")!==-1)for(var me=+be;me--;)J(re);else{re=be;var ee=be.split(">"),ce=ee[0],ye=ee[1];ce=String.fromCodePoint(O+=parseInt(ce,Y)),ye=String.fromCodePoint(O+=parseInt(ye,Y)),ae.set(ce,ye),te&&Q.set(ye,ce)}}),{map:ae,reverseMap:Q}}var g,k,p;function T(){if(!g){var L=y(m.pairs,!0),te=L.map,Y=L.reverseMap;g=te,k=Y,p=y(m.canonical,!1).map}}function w(L){return T(),g.get(L)||null}function _(L){return T(),k.get(L)||null}function S(L){return T(),p.get(L)||null}var x=c.L,U=c.R,X=c.EN,K=c.ES,ne=c.ET,b=c.AN,B=c.CS,C=c.B,j=c.S,N=c.ON,le=c.BN,ie=c.NSM,D=c.AL,W=c.LRO,v=c.RLO,E=c.LRE,G=c.RLE,P=c.PDF,F=c.LRI,I=c.RLI,A=c.FSI,R=c.PDI;function z(L,te){for(var Y=125,O=new Uint32Array(L.length),ae=0;ae<L.length;ae++)O[ae]=u(L[ae]);var Q=new Map;function re(Le,Ze){var Ne=O[Le];O[Le]=Ze,Q.set(Ne,Q.get(Ne)-1),Ne&a&&Q.set(a,Q.get(a)-1),Q.set(Ze,(Q.get(Ze)||0)+1),Ze&a&&Q.set(a,(Q.get(a)||0)+1)}for(var J=new Uint8Array(L.length),be=new Map,me=[],ee=null,ce=0;ce<L.length;ce++)ee||me.push(ee={start:ce,end:L.length-1,level:te==="rtl"?1:te==="ltr"?0:Sn(ce,!1)}),O[ce]&C&&(ee.end=ce,ee=null);for(var ye=G|E|v|W|e|R|P|C,Me=function(Le){return Le+(Le&1?1:2)},ue=function(Le){return Le+(Le&1?2:1)},xe=0;xe<me.length;xe++){ee=me[xe];var pe=[{_level:ee.level,_override:0,_isolate:0}],oe=void 0,_e=0,Se=0,Re=0;Q.clear();for(var de=ee.start;de<=ee.end;de++){var Ae=O[de];if(oe=pe[pe.length-1],Q.set(Ae,(Q.get(Ae)||0)+1),Ae&a&&Q.set(a,(Q.get(a)||0)+1),Ae&ye)if(Ae&(G|E)){J[de]=oe._level;var Ie=(Ae===G?ue:Me)(oe._level);Ie<=Y&&!_e&&!Se?pe.push({_level:Ie,_override:0,_isolate:0}):_e||Se++}else if(Ae&(v|W)){J[de]=oe._level;var qe=(Ae===v?ue:Me)(oe._level);qe<=Y&&!_e&&!Se?pe.push({_level:qe,_override:Ae&v?U:x,_isolate:0}):_e||Se++}else if(Ae&e){Ae&A&&(Ae=Sn(de+1,!0)===1?I:F),J[de]=oe._level,oe._override&&re(de,oe._override);var st=(Ae===I?ue:Me)(oe._level);st<=Y&&_e===0&&Se===0?(Re++,pe.push({_level:st,_override:0,_isolate:1,_isolInitIndex:de})):_e++}else if(Ae&R){if(_e>0)_e--;else if(Re>0){for(Se=0;!pe[pe.length-1]._isolate;)pe.pop();var $e=pe[pe.length-1]._isolInitIndex;$e!=null&&(be.set($e,de),be.set(de,$e)),pe.pop(),Re--}oe=pe[pe.length-1],J[de]=oe._level,oe._override&&re(de,oe._override)}else Ae&P?(_e===0&&(Se>0?Se--:!oe._isolate&&pe.length>1&&(pe.pop(),oe=pe[pe.length-1])),J[de]=oe._level):Ae&C&&(J[de]=ee.level);else J[de]=oe._level,oe._override&&Ae!==le&&re(de,oe._override)}for(var Xe=[],Ve=null,ke=ee.start;ke<=ee.end;ke++){var _t=O[ke];if(!(_t&n)){var Ce=J[ke],Fe=_t&e,Je=_t===R;Ve&&Ce===Ve._level?(Ve._end=ke,Ve._endsWithIsolInit=Fe):Xe.push(Ve={_start:ke,_end:ke,_level:Ce,_startsWithPDI:Je,_endsWithIsolInit:Fe})}}for(var je=[],Te=0;Te<Xe.length;Te++){var Pe=Xe[Te];if(!Pe._startsWithPDI||Pe._startsWithPDI&&!be.has(Pe._start)){for(var Ye=[Ve=Pe],Ge=void 0;Ve&&Ve._endsWithIsolInit&&(Ge=be.get(Ve._end))!=null;)for(var De=Te+1;De<Xe.length;De++)if(Xe[De]._start===Ge){Ye.push(Ve=Xe[De]);break}for(var We=[],et=0;et<Ye.length;et++)for(var Ke=Ye[et],lt=Ke._start;lt<=Ke._end;lt++)We.push(lt);for(var Sa=J[We[0]],on=ee.level,Bt=We[0]-1;Bt>=0;Bt--)if(!(O[Bt]&n)){on=J[Bt];break}var cr=We[We.length-1],Ea=J[cr],sn=ee.level;if(!(O[cr]&e)){for(var It=cr+1;It<=ee.end;It++)if(!(O[It]&n)){sn=J[It];break}}je.push({_seqIndices:We,_sosType:Math.max(on,Sa)%2?U:x,_eosType:Math.max(sn,Ea)%2?U:x})}}for(var hr=0;hr<je.length;hr++){var dr=je[hr],Z=dr._seqIndices,Tt=dr._sosType,xa=dr._eosType;if(Q.get(ie))for(var Wt=0;Wt<Z.length;Wt++){var ln=Z[Wt];if(O[ln]&ie){for(var vr=Tt,Nt=Wt-1;Nt>=0;Nt--)if(!(O[Z[Nt]]&n)){vr=O[Z[Nt]];break}re(ln,vr&(e|R)?N:vr)}}if(Q.get(X))for(var zt=0;zt<Z.length;zt++){var fn=Z[zt];if(O[fn]&X)for(var Vt=zt-1;Vt>=-1;Vt--){var un=Vt===-1?Tt:O[Z[Vt]];if(un&o){un===D&&re(fn,b);break}}}if(Q.get(D))for(var pr=0;pr<Z.length;pr++){var cn=Z[pr];O[cn]&D&&re(cn,U)}if(Q.get(K)||Q.get(B))for(var Ut=1;Ut<Z.length-1;Ut++){var gr=Z[Ut];if(O[gr]&(K|B)){for(var ct=0,mr=0,yr=Ut-1;yr>=0&&(ct=O[Z[yr]],!!(ct&n));yr--);for(var br=Ut+1;br<Z.length&&(mr=O[Z[br]],!!(mr&n));br++);ct===mr&&(O[gr]===K?ct===X:ct&(X|b))&&re(gr,ct)}}if(Q.get(X))for(var St=0;St<Z.length;St++){var wa=Z[St];if(O[wa]&X){for(var jt=St-1;jt>=0&&O[Z[jt]]&(ne|n);jt--)re(Z[jt],X);for(var Ht=St+1;Ht<Z.length&&O[Z[Ht]]&(ne|n);Ht++)re(Z[Ht],X)}}if(Q.get(ne)||Q.get(K)||Q.get(B))for(var Et=0;Et<Z.length;Et++){var hn=Z[Et];if(O[hn]&(ne|K|B)){re(hn,N);for(var Xt=Et-1;Xt>=0&&O[Z[Xt]]&n;Xt--)re(Z[Xt],N);for(var Yt=Et+1;Yt<Z.length&&O[Z[Yt]]&n;Yt++)re(Z[Yt],N)}}if(Q.get(X))for(var _r=0,dn=Tt;_r<Z.length;_r++){var vn=Z[_r],Tr=O[vn];Tr&X?dn===x&&re(vn,x):Tr&o&&(dn=Tr)}if(Q.get(a)){var xt=U|X|b,pn=xt|x,Jt=[];{for(var ht=[],dt=0;dt<Z.length;dt++)if(O[Z[dt]]&a){var wt=L[Z[dt]],gn=void 0;if(w(wt)!==null)if(ht.length<63)ht.push({char:wt,seqIndex:dt});else break;else if((gn=_(wt))!==null)for(var At=ht.length-1;At>=0;At--){var Ur=ht[At].char;if(Ur===gn||Ur===_(S(wt))||w(S(Ur))===wt){Jt.push([ht[At].seqIndex,dt]),ht.length=At;break}}}Jt.sort(function(Le,Ze){return Le[0]-Ze[0]})}for(var Sr=0;Sr<Jt.length;Sr++){for(var mn=Jt[Sr],kt=mn[0],Kt=mn[1],yn=!1,Qe=0,Er=kt+1;Er<Kt;Er++){var xr=Z[Er];if(O[xr]&pn){yn=!0;var bn=O[xr]&xt?U:x;if(bn===vt(xr)){Qe=bn;break}}}if(yn&&!Qe){Qe=Tt;for(var wr=kt-1;wr>=0;wr--){var Qt=Z[wr];if(O[Qt]&pn){var _n=O[Qt]&xt?U:x;_n!==vt(Qt)?Qe=_n:Qe=vt(Qt);break}}}if(Qe){if(O[Z[kt]]=O[Z[Kt]]=Qe,Qe!==vt(Z[kt])){for(var Ft=kt+1;Ft<Z.length;Ft++)if(!(O[Z[Ft]]&n)){u(L[Z[Ft]])&ie&&(O[Z[Ft]]=Qe);break}}if(Qe!==vt(Z[Kt])){for(var Ct=Kt+1;Ct<Z.length;Ct++)if(!(O[Z[Ct]]&n)){u(L[Z[Ct]])&ie&&(O[Z[Ct]]=Qe);break}}}}for(var tt=0;tt<Z.length;tt++)if(O[Z[tt]]&a){for(var Tn=tt,Ar=tt,kr=Tt,Mt=tt-1;Mt>=0;Mt--)if(O[Z[Mt]]&n)Tn=Mt;else{kr=O[Z[Mt]]&xt?U:x;break}for(var Un=xa,Rt=tt+1;Rt<Z.length;Rt++)if(O[Z[Rt]]&(a|n))Ar=Rt;else{Un=O[Z[Rt]]&xt?U:x;break}for(var Zt=Tn;Zt<=Ar;Zt++)O[Z[Zt]]=kr===Un?kr:vt(Z[Zt]);tt=Ar}}}for(var He=ee.start;He<=ee.end;He++){var Aa=J[He],qt=O[He];if(Aa&1?qt&(x|X|b)&&J[He]++:qt&U?J[He]++:qt&(b|X)&&(J[He]+=2),qt&n&&(J[He]=He===0?ee.level:J[He-1]),He===ee.end||u(L[He])&(j|C))for(var $t=He;$t>=0&&u(L[$t])&i;$t--)J[$t]=ee.level}}return{levels:J,paragraphs:me};function Sn(Le,Ze){for(var Ne=Le;Ne<L.length;Ne++){var rt=O[Ne];if(rt&(U|D))return 1;if(rt&(C|x)||Ze&&rt===R)return 0;if(rt&e){var En=ka(Ne);Ne=En===-1?L.length:En}}return 0}function ka(Le){for(var Ze=1,Ne=Le+1;Ne<L.length;Ne++){var rt=O[Ne];if(rt&C)break;if(rt&R){if(--Ze===0)return Ne}else rt&e&&Ze++}return-1}function vt(Le){return J[Le]&1?U:x}}var q="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",V;function M(){if(!V){var L=y(q,!0),te=L.map,Y=L.reverseMap;Y.forEach(function(O,ae){te.set(ae,O)}),V=te}}function ve(L){return M(),V.get(L)||null}function he(L,te,Y,O){var ae=L.length;Y=Math.max(0,Y==null?0:+Y),O=Math.min(ae-1,O==null?ae-1:+O);for(var Q=new Map,re=Y;re<=O;re++)if(te[re]&1){var J=ve(L[re]);J!==null&&Q.set(re,J)}return Q}function H(L,te,Y,O){var ae=L.length;Y=Math.max(0,Y==null?0:+Y),O=Math.min(ae-1,O==null?ae-1:+O);var Q=[];return te.paragraphs.forEach(function(re){var J=Math.max(Y,re.start),be=Math.min(O,re.end);if(J<be){for(var me=te.levels.slice(J,be+1),ee=be;ee>=J&&u(L[ee])&i;ee--)me[ee]=re.level;for(var ce=re.level,ye=1/0,Me=0;Me<me.length;Me++){var ue=me[Me];ue>ce&&(ce=ue),ue<ye&&(ye=ue|1)}for(var xe=ce;xe>=ye;xe--)for(var pe=0;pe<me.length;pe++)if(me[pe]>=xe){for(var oe=pe;pe+1<me.length&&me[pe+1]>=xe;)pe++;pe>oe&&Q.push([oe+Y,pe+Y])}}}),Q}function $(L,te,Y,O){var ae=fe(L,te,Y,O),Q=[].concat(L);return ae.forEach(function(re,J){Q[J]=(te.levels[re]&1?ve(L[re]):null)||L[re]}),Q.join("")}function fe(L,te,Y,O){for(var ae=H(L,te,Y,O),Q=[],re=0;re<L.length;re++)Q[re]=re;return ae.forEach(function(J){for(var be=J[0],me=J[1],ee=Q.slice(be,me+1),ce=ee.length;ce--;)Q[me-ce]=ee[ce]}),Q}return r.closingToOpeningBracket=_,r.getBidiCharType=u,r.getBidiCharTypeName=h,r.getCanonicalBracket=S,r.getEmbeddingLevels=z,r.getMirroredCharacter=ve,r.getMirroredCharactersMap=he,r.getReorderSegments=H,r.getReorderedIndices=fe,r.getReorderedString=$,r.openingToClosingBracket=w,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}const Lr=/\bvoid\s+main\s*\(\s*\)\s*{/g;function nr(l){const r=/^[ \t]*#include +<([\w\d./]+)>/gm;function d(c,t){let e=AFRAME.THREE.ShaderChunk[t];return e?nr(e):c}return l.replace(r,d)}const Oe=[];for(let l=0;l<256;l++)Oe[l]=(l<16?"0":"")+l.toString(16);function Pn(){const l=Math.random()*4294967295|0,r=Math.random()*4294967295|0,d=Math.random()*4294967295|0,c=Math.random()*4294967295|0;return(Oe[l&255]+Oe[l>>8&255]+Oe[l>>16&255]+Oe[l>>24&255]+"-"+Oe[r&255]+Oe[r>>8&255]+"-"+Oe[r>>16&15|64]+Oe[r>>24&255]+"-"+Oe[d&63|128]+Oe[d>>8&255]+"-"+Oe[d>>16&255]+Oe[d>>24&255]+Oe[c&255]+Oe[c>>8&255]+Oe[c>>16&255]+Oe[c>>24&255]).toUpperCase()}const ot=Object.assign||function(){let l=arguments[0];for(let r=1,d=arguments.length;r<d;r++){let c=arguments[r];if(c)for(let t in c)c.hasOwnProperty(t)&&(l[t]=c[t])}return l},Gn=Date.now(),Br=new WeakMap,Ir=new Map;let Ln=1e10;function ar(l,r){const d=Nn(r);let c=Br.get(l);if(c||Br.set(l,c=Object.create(null)),c[d])return new c[d];const t=`_onBeforeCompile${d}`,e=function(i){l.onBeforeCompile.call(this,i);const s=this.customProgramCacheKey()+"|"+i.vertexShader+"|"+i.fragmentShader;let f=Ir[s];if(!f){const u=Bn(i,r,d);f=Ir[s]=u}i.vertexShader=f.vertexShader,i.fragmentShader=f.fragmentShader,ot(i.uniforms,this.uniforms),r.timeUniform&&(i.uniforms[r.timeUniform]={get value(){return Date.now()-Gn}}),this[t]&&this[t](i)},o=function(){return a(r.chained?l:l.clone())},a=function(i){const s=Object.create(i,n);return Object.defineProperty(s,"baseMaterial",{value:l}),Object.defineProperty(s,"id",{value:Ln++}),s.uuid=Pn(),s.uniforms=ot({},i.uniforms,r.uniforms),s.defines=ot({},i.defines,r.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${d}`]="",s.extensions=ot({},i.extensions,r.extensions),s._listeners=void 0,s},n={constructor:{value:o},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return l.customProgramCacheKey()+"|"+d}},onBeforeCompile:{get(){return e},set(i){this[t]=i}},copy:{writable:!0,configurable:!0,value:function(i){return l.copy.call(this,i),!l.isShaderMaterial&&!l.isDerivedMaterial&&(ot(this.extensions,i.extensions),ot(this.defines,i.defines),ot(this.uniforms,AFRAME.THREE.UniformsUtils.clone(i.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const i=new l.constructor;return a(i).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let i=this._depthMaterial;return i||(i=this._depthMaterial=ar(l.isDerivedMaterial?l.getDepthMaterial():new AFRAME.THREE.MeshDepthMaterial({depthPacking:AFRAME.THREE.RGBADepthPacking}),r),i.defines.IS_DEPTH_MATERIAL="",i.uniforms=this.uniforms),i}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let i=this._distanceMaterial;return i||(i=this._distanceMaterial=ar(l.isDerivedMaterial?l.getDistanceMaterial():new AFRAME.THREE.MeshDistanceMaterial,r),i.defines.IS_DISTANCE_MATERIAL="",i.uniforms=this.uniforms),i}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:i,_distanceMaterial:s}=this;i&&i.dispose(),s&&s.dispose(),l.dispose.call(this)}}};return c[d]=o,new o}function Bn({vertexShader:l,fragmentShader:r},d,c){let{vertexDefs:t,vertexMainIntro:e,vertexMainOutro:o,vertexTransform:a,fragmentDefs:n,fragmentMainIntro:i,fragmentMainOutro:s,fragmentColorTransform:f,customRewriter:u,timeUniform:h}=d;if(t=t||"",e=e||"",o=o||"",n=n||"",i=i||"",s=s||"",(a||u)&&(l=nr(l)),(f||u)&&(r=r.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),r=nr(r)),u){let m=u({vertexShader:l,fragmentShader:r});l=m.vertexShader,r=m.fragmentShader}if(f){let m=[];r=r.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,y=>(m.push(y),"")),s=`${f}
${m.join(`
`)}
${s}`}if(h){const m=`
uniform float ${h};
`;t=m+t,n=m+n}return a&&(l=`vec3 troika_position_${c};
vec3 troika_normal_${c};
vec2 troika_uv_${c};
${l}
`,t=`${t}
void troikaVertexTransform${c}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${a}
}
`,e=`
troika_position_${c} = vec3(position);
troika_normal_${c} = vec3(normal);
troika_uv_${c} = vec2(uv);
troikaVertexTransform${c}(troika_position_${c}, troika_normal_${c}, troika_uv_${c});
${e}
`,l=l.replace(/\b(position|normal|uv)\b/g,(m,y,g,k)=>/\battribute\s+vec[23]\s+$/.test(k.substr(0,g))?y:`troika_${y}_${c}`)),l=Wr(l,c,t,e,o),r=Wr(r,c,n,i,s),{vertexShader:l,fragmentShader:r}}function Wr(l,r,d,c,t){return(c||t||d)&&(l=l.replace(Lr,`
${d}
void troikaOrigMain${r}() {`),l+=`
void main() {
  ${c}
  troikaOrigMain${r}();
  ${t}
}`),l}function In(l,r){return l==="uniforms"?void 0:typeof r=="function"?r.toString():r}let Wn=0;const Nr=new Map;function Nn(l){const r=JSON.stringify(l,In);let d=Nr.get(r);return d==null&&Nr.set(r,d=++Wn),d}function zn(l,r,d){const{defaultFontURL:c}=d,t=Object.create(null),e=1/0,o=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,a="[^\\S\\u00A0]",n=new RegExp(`${a}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function i(p,T){function w(){const _=S=>{console.error(`Failure loading font ${p}${p===c?"":"; trying fallback"}`,S),p!==c&&(p=c,w())};try{const S=new XMLHttpRequest;S.open("get",p,!0),S.responseType="arraybuffer",S.onload=function(){if(S.status>=400)_(new Error(S.statusText));else if(S.status>0)try{const x=l(S.response);T(x)}catch(x){_(x)}},S.onerror=_,S.send()}catch(S){_(S)}}w()}function s(p,T){p||(p=c);let w=t[p];w?w.pending?w.pending.push(T):T(w):(t[p]={pending:[T]},i(p,_=>{let S=t[p].pending;t[p]=_,S.forEach(x=>x(_))}))}function f({text:p="",font:T=c,sdfGlyphSize:w=64,fontSize:_=1,letterSpacing:S=0,lineHeight:x="normal",maxWidth:U=e,direction:X,textAlign:K="left",textIndent:ne=0,whiteSpace:b="normal",overflowWrap:B="normal",anchorX:C=0,anchorY:j=0,includeCaretPositions:N=!1,chunkedBoundsSize:le=8192,colorRanges:ie=null},D,W=!1){const v=y(),E={fontLoad:0,typesetting:0};p.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),p=p.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),_=+_,S=+S,U=+U,x=x||"normal",ne=+ne,s(T,G=>{const P=isFinite(U);let F=null,I=null,A=null,R=null,z=null,q=null,V=null,M=0,ve=0,he=b!=="nowrap";const{ascender:H,descender:$,unitsPerEm:fe,lineGap:L,capHeight:te,xHeight:Y}=G;E.fontLoad=y()-v;const O=y(),ae=_/fe;x==="normal"&&(x=(H-$+L)/fe),x=x*_;const Q=(x-(H-$)*ae)/2,re=-(H*ae+Q),J=Math.min(x,(H-$)*ae),be=(H+$)/2*ae-J/2;let me=ne,ee=new g;const ce=[ee];G.forEachGlyph(p,_,S,(ue,xe,pe)=>{const oe=p.charAt(pe),_e=ue.advanceWidth*ae,Se=ee.count;let Re;if("isEmpty"in ue||(ue.isWhitespace=!!oe&&new RegExp(a).test(oe),ue.canBreakAfter=!!oe&&n.test(oe),ue.isEmpty=ue.xMin===ue.xMax||ue.yMin===ue.yMax||o.test(oe)),!ue.isWhitespace&&!ue.isEmpty&&ve++,he&&P&&!ue.isWhitespace&&xe+_e+me>U&&Se){if(ee.glyphAt(Se-1).glyphObj.canBreakAfter)Re=new g,me=-xe;else for(let Ae=Se;Ae--;)if(Ae===0&&B==="break-word"){Re=new g,me=-xe;break}else if(ee.glyphAt(Ae).glyphObj.canBreakAfter){Re=ee.splitAt(Ae+1);const Ie=Re.glyphAt(0).x;me-=Ie;for(let qe=Re.count;qe--;)Re.glyphAt(qe).x-=Ie;break}Re&&(ee.isSoftWrapped=!0,ee=Re,ce.push(ee),M=U)}let de=ee.glyphAt(ee.count);de.glyphObj=ue,de.x=xe+me,de.width=_e,de.charIndex=pe,oe===`
`&&(ee=new g,ce.push(ee),me=-(xe+_e+S*_)+ne)}),ce.forEach(ue=>{for(let xe=ue.count;xe--;){let{glyphObj:pe,x:oe,width:_e}=ue.glyphAt(xe);if(!pe.isWhitespace){ue.width=oe+_e,ue.width>M&&(M=ue.width);return}}});let ye=0,Me=0;if(C&&(typeof C=="number"?ye=-C:typeof C=="string"&&(ye=-M*(C==="left"?0:C==="center"?.5:C==="right"?1:h(C)))),j){if(typeof j=="number")Me=-j;else if(typeof j=="string"){let ue=ce.length*x;Me=j==="top"?0:j==="top-baseline"?-re:j==="top-cap"?-re-te*ae:j==="top-ex"?-re-Y*ae:j==="middle"?ue/2:j==="bottom"?ue:j==="bottom-baseline"?ue-Q+$*ae:h(j)*ue}}if(!W){const ue=r.getEmbeddingLevels(p,X);F=new Uint16Array(ve),I=new Float32Array(ve*2),A={},q=[e,e,-e,-e],V=[];let xe=re;N&&(z=new Float32Array(p.length*3)),ie&&(R=new Uint8Array(ve*3));let pe=0,oe=-1,_e=-1,Se,Re;if(ce.forEach((de,Ae)=>{let{count:Ie,width:qe}=de;if(Ie>0){let st=0;for(let Ce=Ie;Ce--&&de.glyphAt(Ce).glyphObj.isWhitespace;)st++;let $e=0,Xe=0;if(K==="center")$e=(M-qe)/2;else if(K==="right")$e=M-qe;else if(K==="justify"&&de.isSoftWrapped){let Ce=0;for(let Fe=Ie-st;Fe--;)de.glyphAt(Fe).glyphObj.isWhitespace&&Ce++;Xe=(M-qe)/Ce}if(Xe||$e){let Ce=0;for(let Fe=0;Fe<Ie;Fe++){let Je=de.glyphAt(Fe);const je=Je.glyphObj;Je.x+=$e+Ce,Xe!==0&&je.isWhitespace&&Fe<Ie-st&&(Ce+=Xe,Je.width+=Xe)}}const Ve=r.getReorderSegments(p,ue,de.glyphAt(0).charIndex,de.glyphAt(de.count-1).charIndex);for(let Ce=0;Ce<Ve.length;Ce++){const[Fe,Je]=Ve[Ce];let je=1/0,Te=-1/0;for(let Pe=0;Pe<Ie;Pe++)if(de.glyphAt(Pe).charIndex>=Fe){let Ye=Pe,Ge=Pe;for(;Ge<Ie;Ge++){let De=de.glyphAt(Ge);if(De.charIndex>Je)break;Ge<Ie-st&&(je=Math.min(je,De.x),Te=Math.max(Te,De.x+De.width))}for(let De=Ye;De<Ge;De++){const We=de.glyphAt(De);We.x=Te-(We.x+We.width-je)}break}}let ke;const _t=Ce=>ke=Ce;for(let Ce=0;Ce<Ie;Ce++){let Fe=de.glyphAt(Ce);ke=Fe.glyphObj;const Je=ke.index,je=ue.levels[Fe.charIndex]&1;if(je){const Te=r.getMirroredCharacter(p[Fe.charIndex]);Te&&G.forEachGlyph(Te,0,0,_t)}if(N){const{charIndex:Te}=Fe,Pe=Fe.x+ye,Ye=Fe.x+Fe.width+ye;z[Te*3]=je?Ye:Pe,z[Te*3+1]=je?Pe:Ye,z[Te*3+2]=xe+be+Me;const Ge=Te-oe;Ge>1&&m(z,oe,Ge),oe=Te}if(ie){const{charIndex:Te}=Fe;for(;Te>_e;)_e++,ie.hasOwnProperty(_e)&&(Re=ie[_e])}if(!ke.isWhitespace&&!ke.isEmpty){const Te=pe++;A[Je]||(A[Je]={path:ke.path,pathBounds:[ke.xMin,ke.yMin,ke.xMax,ke.yMax]});const Pe=Fe.x+ye,Ye=xe+Me;I[Te*2]=Pe,I[Te*2+1]=Ye;const Ge=Pe+ke.xMin*ae,De=Ye+ke.yMin*ae,We=Pe+ke.xMax*ae,et=Ye+ke.yMax*ae;Ge<q[0]&&(q[0]=Ge),De<q[1]&&(q[1]=De),We>q[2]&&(q[2]=We),et>q[3]&&(q[3]=et),Te%le===0&&(Se={start:Te,end:Te,rect:[e,e,-e,-e]},V.push(Se)),Se.end++;const Ke=Se.rect;if(Ge<Ke[0]&&(Ke[0]=Ge),De<Ke[1]&&(Ke[1]=De),We>Ke[2]&&(Ke[2]=We),et>Ke[3]&&(Ke[3]=et),F[Te]=Je,ie){const lt=Te*3;R[lt]=Re>>16&255,R[lt+1]=Re>>8&255,R[lt+2]=Re&255}}}}xe-=x}),z){const de=p.length-oe;de>1&&m(z,oe,de)}}E.typesetting=y()-O,D({glyphIds:F,glyphPositions:I,glyphData:A,caretPositions:z,caretHeight:J,glyphColors:R,chunkedBounds:V,fontSize:_,unitsPerEm:fe,ascender:H*ae,descender:$*ae,capHeight:te*ae,xHeight:Y*ae,lineHeight:x,topBaseline:re,blockBounds:[ye,Me-ce.length*x,ye+M,Me],visibleBounds:q,timings:E})})}function u(p,T){f(p,w=>{const[_,S,x,U]=w.blockBounds;T({width:x-_,height:U-S})},{metricsOnly:!0})}function h(p){let T=p.match(/^([\d.]+)%$/),w=T?parseFloat(T[1]):NaN;return isNaN(w)?0:w/100}function m(p,T,w){const _=p[T*3],S=p[T*3+1],x=p[T*3+2],U=(S-_)/w;for(let X=0;X<w;X++){const K=(T+X)*3;p[K]=_+U*X,p[K+1]=_+U*(X+1),p[K+2]=x}}function y(){return(self.performance||Date).now()}function g(){this.data=[]}const k=["glyphObj","x","width","charIndex"];return g.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/k.length)},glyphAt(p){let T=g.flyweight;return T.data=this.data,T.index=p,T},splitAt(p){let T=new g;return T.data=this.data.splice(p*k.length),T}},g.flyweight=k.reduce((p,T,w,_)=>(Object.defineProperty(p,T,{get(){return this.data[this.index*k.length+w]},set(S){this.data[this.index*k.length+w]=S}}),p),{data:null,index:0}),{typeset:f,measure:u,loadFont:s}}const it=()=>(self.performance||Date).now(),Ot=Gr();let zr;function Vn(l,r,d,c,t,e,o,a,n,i,s=!0){return s?Hn(l,r,d,c,t,e,o,a,n,i).then(null,f=>(zr||(console.warn("WebGL SDF generation failed, falling back to JS",f),zr=!0),Hr(l,r,d,c,t,e,o,a,n,i))):Hr(l,r,d,c,t,e,o,a,n,i)}const Pt=[],jn=5;let or=0;function Vr(){const l=it();for(;Pt.length&&it()-l<jn;)Pt.shift()();or=Pt.length?setTimeout(Vr,0):0}const Hn=(...l)=>new Promise((r,d)=>{Pt.push(()=>{const c=it();try{Ot.webgl.generateIntoCanvas(...l),r({timing:it()-c})}catch(t){d(t)}}),or||(or=setTimeout(Vr,0))}),Xn=4,Yn=2e3,jr={};let Jn=0;function Hr(l,r,d,c,t,e,o,a,n,i){const s="TroikaTextSDFGenerator_JS_"+Jn++%Xn;let f=jr[s];return f||(f=jr[s]={workerModule:mt({name:s,workerId:s,dependencies:[Gr,it],init(u,h){const m=u().javascript.generate;return function(...y){const g=h();return{textureData:m(...y),timing:h()-g}}},getTransferables(u){return[u.textureData.buffer]}}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(l,r,d,c,t,e).then(({textureData:u,timing:h})=>{const m=it(),y=new Uint8Array(u.length*4);for(let g=0;g<u.length;g++)y[g*4+i]=u[g];return Ot.webglUtils.renderImageData(o,y,a,n,l,r,1<<3-i),h+=it()-m,--f.requests===0&&(f.idleTimer=setTimeout(()=>{Rn(s)},Yn)),{timing:h}})}function Kn(l){l._warm||(Ot.webgl.isSupported(l),l._warm=!0)}const Qn=Ot.webglUtils.resizeWebGLCanvasWithoutClearing;/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Zn(){return typeof window>"u"&&(self.window=self),function(l){var r={parse:function(t){var e=r._bin,o=new Uint8Array(t);if(e.readASCII(o,0,4)=="ttcf"){var a=4;e.readUshort(o,a),a+=2,e.readUshort(o,a),a+=2;var n=e.readUint(o,a);a+=4;for(var i=[],s=0;s<n;s++){var f=e.readUint(o,a);a+=4,i.push(r._readFont(o,f))}return i}return[r._readFont(o,0)]},_readFont:function(t,e){var o=r._bin,a=e;o.readFixed(t,e),e+=4;var n=o.readUshort(t,e);e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2;for(var i=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],s={_data:t,_offset:a},f={},u=0;u<n;u++){var h=o.readASCII(t,e,4);e+=4,o.readUint(t,e),e+=4;var m=o.readUint(t,e);e+=4;var y=o.readUint(t,e);e+=4,f[h]={offset:m,length:y}}for(u=0;u<i.length;u++){var g=i[u];f[g]&&(s[g.trim()]=r[g.trim()].parse(t,f[g].offset,f[g].length,s))}return s},_tabOffset:function(t,e,o){for(var a=r._bin,n=a.readUshort(t,o+4),i=o+12,s=0;s<n;s++){var f=a.readASCII(t,i,4);i+=4,a.readUint(t,i),i+=4;var u=a.readUint(t,i);if(i+=4,a.readUint(t,i),i+=4,f==e)return u}return 0}};r._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return r._bin.readShort(t,e)/16384},readInt:function(t,e){return r._bin._view(t).getInt32(e)},readInt8:function(t,e){return r._bin._view(t).getInt8(e)},readShort:function(t,e){return r._bin._view(t).getInt16(e)},readUshort:function(t,e){return r._bin._view(t).getUint16(e)},readUshorts:function(t,e,o){for(var a=[],n=0;n<o;n++)a.push(r._bin.readUshort(t,e+2*n));return a},readUint:function(t,e){return r._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*r._bin.readUint(t,e)+r._bin.readUint(t,e+4)},readASCII:function(t,e,o){for(var a="",n=0;n<o;n++)a+=String.fromCharCode(t[e+n]);return a},readUnicode:function(t,e,o){for(var a="",n=0;n<o;n++){var i=t[e++]<<8|t[e++];a+=String.fromCharCode(i)}return a},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,o){var a=r._bin._tdec;return a&&e==0&&o==t.length?a.decode(t):r._bin.readASCII(t,e,o)},readBytes:function(t,e,o){for(var a=[],n=0;n<o;n++)a.push(t[e+n]);return a},readASCIIArray:function(t,e,o){for(var a=[],n=0;n<o;n++)a.push(String.fromCharCode(t[e+n]));return a},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},r._lctf={},r._lctf.parse=function(t,e,o,a,n){var i=r._bin,s={},f=e;i.readFixed(t,e),e+=4;var u=i.readUshort(t,e);e+=2;var h=i.readUshort(t,e);e+=2;var m=i.readUshort(t,e);return e+=2,s.scriptList=r._lctf.readScriptList(t,f+u),s.featureList=r._lctf.readFeatureList(t,f+h),s.lookupList=r._lctf.readLookupList(t,f+m,n),s},r._lctf.readLookupList=function(t,e,o){var a=r._bin,n=e,i=[],s=a.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var u=a.readUshort(t,e);e+=2;var h=r._lctf.readLookupTable(t,n+u,o);i.push(h)}return i},r._lctf.readLookupTable=function(t,e,o){var a=r._bin,n=e,i={tabs:[]};i.ltype=a.readUshort(t,e),e+=2,i.flag=a.readUshort(t,e),e+=2;var s=a.readUshort(t,e);e+=2;for(var f=i.ltype,u=0;u<s;u++){var h=a.readUshort(t,e);e+=2;var m=o(t,f,n+h,i);i.tabs.push(m)}return i},r._lctf.numOfOnes=function(t){for(var e=0,o=0;o<32;o++)t>>>o&1&&e++;return e},r._lctf.readClassDef=function(t,e){var o=r._bin,a=[],n=o.readUshort(t,e);if(e+=2,n==1){var i=o.readUshort(t,e);e+=2;var s=o.readUshort(t,e);e+=2;for(var f=0;f<s;f++)a.push(i+f),a.push(i+f),a.push(o.readUshort(t,e)),e+=2}if(n==2){var u=o.readUshort(t,e);for(e+=2,f=0;f<u;f++)a.push(o.readUshort(t,e)),e+=2,a.push(o.readUshort(t,e)),e+=2,a.push(o.readUshort(t,e)),e+=2}return a},r._lctf.getInterval=function(t,e){for(var o=0;o<t.length;o+=3){var a=t[o],n=t[o+1];if(t[o+2],a<=e&&e<=n)return o}return-1},r._lctf.readCoverage=function(t,e){var o=r._bin,a={};a.fmt=o.readUshort(t,e),e+=2;var n=o.readUshort(t,e);return e+=2,a.fmt==1&&(a.tab=o.readUshorts(t,e,n)),a.fmt==2&&(a.tab=o.readUshorts(t,e,3*n)),a},r._lctf.coverageIndex=function(t,e){var o=t.tab;if(t.fmt==1)return o.indexOf(e);if(t.fmt==2){var a=r._lctf.getInterval(o,e);if(a!=-1)return o[a+2]+(e-o[a])}return-1},r._lctf.readFeatureList=function(t,e){var o=r._bin,a=e,n=[],i=o.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=o.readASCII(t,e,4);e+=4;var u=o.readUshort(t,e);e+=2;var h=r._lctf.readFeatureTable(t,a+u);h.tag=f.trim(),n.push(h)}return n},r._lctf.readFeatureTable=function(t,e){var o=r._bin,a=e,n={},i=o.readUshort(t,e);e+=2,i>0&&(n.featureParams=a+i);var s=o.readUshort(t,e);e+=2,n.tab=[];for(var f=0;f<s;f++)n.tab.push(o.readUshort(t,e+2*f));return n},r._lctf.readScriptList=function(t,e){var o=r._bin,a=e,n={},i=o.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=o.readASCII(t,e,4);e+=4;var u=o.readUshort(t,e);e+=2,n[f.trim()]=r._lctf.readScriptTable(t,a+u)}return n},r._lctf.readScriptTable=function(t,e){var o=r._bin,a=e,n={},i=o.readUshort(t,e);e+=2,n.default=r._lctf.readLangSysTable(t,a+i);var s=o.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var u=o.readASCII(t,e,4);e+=4;var h=o.readUshort(t,e);e+=2,n[u.trim()]=r._lctf.readLangSysTable(t,a+h)}return n},r._lctf.readLangSysTable=function(t,e){var o=r._bin,a={};o.readUshort(t,e),e+=2,a.reqFeature=o.readUshort(t,e),e+=2;var n=o.readUshort(t,e);return e+=2,a.features=o.readUshorts(t,e,n),a},r.CFF={},r.CFF.parse=function(t,e,o){var a=r._bin;(t=new Uint8Array(t.buffer,e,o))[e=0],t[++e],t[++e],t[++e],e++;var n=[];e=r.CFF.readIndex(t,e,n);for(var i=[],s=0;s<n.length-1;s++)i.push(a.readASCII(t,e+n[s],n[s+1]-n[s]));e+=n[n.length-1];var f=[];e=r.CFF.readIndex(t,e,f);var u=[];for(s=0;s<f.length-1;s++)u.push(r.CFF.readDict(t,e+f[s],e+f[s+1]));e+=f[f.length-1];var h=u[0],m=[];e=r.CFF.readIndex(t,e,m);var y=[];for(s=0;s<m.length-1;s++)y.push(a.readASCII(t,e+m[s],m[s+1]-m[s]));if(e+=m[m.length-1],r.CFF.readSubrs(t,e,h),h.CharStrings){e=h.CharStrings,m=[],e=r.CFF.readIndex(t,e,m);var g=[];for(s=0;s<m.length-1;s++)g.push(a.readBytes(t,e+m[s],m[s+1]-m[s]));h.CharStrings=g}if(h.ROS){e=h.FDArray;var k=[];for(e=r.CFF.readIndex(t,e,k),h.FDArray=[],s=0;s<k.length-1;s++){var p=r.CFF.readDict(t,e+k[s],e+k[s+1]);r.CFF._readFDict(t,p,y),h.FDArray.push(p)}e+=k[k.length-1],e=h.FDSelect,h.FDSelect=[];var T=t[e];if(e++,T!=3)throw T;var w=a.readUshort(t,e);for(e+=2,s=0;s<w+1;s++)h.FDSelect.push(a.readUshort(t,e),t[e+2]),e+=3}return h.Encoding&&(h.Encoding=r.CFF.readEncoding(t,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=r.CFF.readCharset(t,h.charset,h.CharStrings.length)),r.CFF._readFDict(t,h,y),h},r.CFF._readFDict=function(t,e,o){var a;for(var n in e.Private&&(a=e.Private[1],e.Private=r.CFF.readDict(t,a,a+e.Private[0]),e.Private.Subrs&&r.CFF.readSubrs(t,a+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(e[n]=o[e[n]-426+35])},r.CFF.readSubrs=function(t,e,o){var a=r._bin,n=[];e=r.CFF.readIndex(t,e,n);var i,s=n.length;i=s<1240?107:s<33900?1131:32768,o.Bias=i,o.Subrs=[];for(var f=0;f<n.length-1;f++)o.Subrs.push(a.readBytes(t,e+n[f],n[f+1]-n[f]))},r.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],r.CFF.glyphByUnicode=function(t,e){for(var o=0;o<t.charset.length;o++)if(t.charset[o]==e)return o;return-1},r.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:r.CFF.glyphByUnicode(t,r.CFF.tableSE[e])},r.CFF.readEncoding=function(t,e,o){r._bin;var a=[".notdef"],n=t[e];if(e++,n!=0)throw"error: unknown encoding format: "+n;var i=t[e];e++;for(var s=0;s<i;s++)a.push(t[e+s]);return a},r.CFF.readCharset=function(t,e,o){var a=r._bin,n=[".notdef"],i=t[e];if(e++,i==0)for(var s=0;s<o;s++){var f=a.readUshort(t,e);e+=2,n.push(f)}else{if(i!=1&&i!=2)throw"error: format: "+i;for(;n.length<o;){f=a.readUshort(t,e),e+=2;var u=0;for(i==1?(u=t[e],e++):(u=a.readUshort(t,e),e+=2),s=0;s<=u;s++)n.push(f),f++}}return n},r.CFF.readIndex=function(t,e,o){var a=r._bin,n=a.readUshort(t,e)+1,i=t[e+=2];if(e++,i==1)for(var s=0;s<n;s++)o.push(t[e+s]);else if(i==2)for(s=0;s<n;s++)o.push(a.readUshort(t,e+2*s));else if(i==3)for(s=0;s<n;s++)o.push(16777215&a.readUint(t,e+3*s-1));else if(n!=1)throw"unsupported offset size: "+i+", count: "+n;return(e+=n*i)-1},r.CFF.getCharString=function(t,e,o){var a=r._bin,n=t[e],i=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,f=null,u=null;n<=20&&(f=n,s=1),n==12&&(f=100*n+i,s=2),21<=n&&n<=27&&(f=n,s=1),n==28&&(u=a.readShort(t,e+1),s=3),29<=n&&n<=31&&(f=n,s=1),32<=n&&n<=246&&(u=n-139,s=1),247<=n&&n<=250&&(u=256*(n-247)+i+108,s=2),251<=n&&n<=254&&(u=256*-(n-251)-i-108,s=2),n==255&&(u=a.readInt(t,e+1)/65535,s=5),o.val=u??"o"+f,o.size=s},r.CFF.readCharString=function(t,e,o){for(var a=e+o,n=r._bin,i=[];e<a;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var u=1,h=null,m=null;s<=20&&(h=s,u=1),s==12&&(h=100*s+f,u=2),s!=19&&s!=20||(h=s,u=2),21<=s&&s<=27&&(h=s,u=1),s==28&&(m=n.readShort(t,e+1),u=3),29<=s&&s<=31&&(h=s,u=1),32<=s&&s<=246&&(m=s-139,u=1),247<=s&&s<=250&&(m=256*(s-247)+f+108,u=2),251<=s&&s<=254&&(m=256*-(s-251)-f-108,u=2),s==255&&(m=n.readInt(t,e+1)/65535,u=5),i.push(m??"o"+h),e+=u}return i},r.CFF.readDict=function(t,e,o){for(var a=r._bin,n={},i=[];e<o;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var u=1,h=null,m=null;if(s==28&&(m=a.readShort(t,e+1),u=3),s==29&&(m=a.readInt(t,e+1),u=5),32<=s&&s<=246&&(m=s-139,u=1),247<=s&&s<=250&&(m=256*(s-247)+f+108,u=2),251<=s&&s<=254&&(m=256*-(s-251)-f-108,u=2),s==255)throw m=a.readInt(t,e+1)/65535,u=5,"unknown number";if(s==30){var y=[];for(u=1;;){var g=t[e+u];u++;var k=g>>4,p=15&g;if(k!=15&&y.push(k),p!=15&&y.push(p),p==15)break}for(var T="",w=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],_=0;_<y.length;_++)T+=w[y[_]];m=parseFloat(T)}s<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],u=1,s==12&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][f],u=2)),h!=null?(n[h]=i.length==1?i[0]:i,i=[]):i.push(m),e+=u}return n},r.cmap={},r.cmap.parse=function(t,e,o){t=new Uint8Array(t.buffer,e,o),e=0;var a=r._bin,n={};a.readUshort(t,e),e+=2;var i=a.readUshort(t,e);e+=2;var s=[];n.tables=[];for(var f=0;f<i;f++){var u=a.readUshort(t,e);e+=2;var h=a.readUshort(t,e);e+=2;var m=a.readUint(t,e);e+=4;var y="p"+u+"e"+h,g=s.indexOf(m);if(g==-1){var k;g=n.tables.length,s.push(m);var p=a.readUshort(t,m);p==0?k=r.cmap.parse0(t,m):p==4?k=r.cmap.parse4(t,m):p==6?k=r.cmap.parse6(t,m):p==12?k=r.cmap.parse12(t,m):console.debug("unknown format: "+p,u,h,m),n.tables.push(k)}if(n[y]!=null)throw"multiple tables for one platform+encoding";n[y]=g}return n},r.cmap.parse0=function(t,e){var o=r._bin,a={};a.format=o.readUshort(t,e),e+=2;var n=o.readUshort(t,e);e+=2,o.readUshort(t,e),e+=2,a.map=[];for(var i=0;i<n-6;i++)a.map.push(t[e+i]);return a},r.cmap.parse4=function(t,e){var o=r._bin,a=e,n={};n.format=o.readUshort(t,e),e+=2;var i=o.readUshort(t,e);e+=2,o.readUshort(t,e),e+=2;var s=o.readUshort(t,e);e+=2;var f=s/2;n.searchRange=o.readUshort(t,e),e+=2,n.entrySelector=o.readUshort(t,e),e+=2,n.rangeShift=o.readUshort(t,e),e+=2,n.endCount=o.readUshorts(t,e,f),e+=2*f,e+=2,n.startCount=o.readUshorts(t,e,f),e+=2*f,n.idDelta=[];for(var u=0;u<f;u++)n.idDelta.push(o.readShort(t,e)),e+=2;for(n.idRangeOffset=o.readUshorts(t,e,f),e+=2*f,n.glyphIdArray=[];e<a+i;)n.glyphIdArray.push(o.readUshort(t,e)),e+=2;return n},r.cmap.parse6=function(t,e){var o=r._bin,a={};a.format=o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2,a.firstCode=o.readUshort(t,e),e+=2;var n=o.readUshort(t,e);e+=2,a.glyphIdArray=[];for(var i=0;i<n;i++)a.glyphIdArray.push(o.readUshort(t,e)),e+=2;return a},r.cmap.parse12=function(t,e){var o=r._bin,a={};a.format=o.readUshort(t,e),e+=2,e+=2,o.readUint(t,e),e+=4,o.readUint(t,e),e+=4;var n=o.readUint(t,e);e+=4,a.groups=[];for(var i=0;i<n;i++){var s=e+12*i,f=o.readUint(t,s+0),u=o.readUint(t,s+4),h=o.readUint(t,s+8);a.groups.push([f,u,h])}return a},r.glyf={},r.glyf.parse=function(t,e,o,a){for(var n=[],i=0;i<a.maxp.numGlyphs;i++)n.push(null);return n},r.glyf._parseGlyf=function(t,e){var o=r._bin,a=t._data,n=r._tabOffset(a,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var i={};if(i.noc=o.readShort(a,n),n+=2,i.xMin=o.readShort(a,n),n+=2,i.yMin=o.readShort(a,n),n+=2,i.xMax=o.readShort(a,n),n+=2,i.yMax=o.readShort(a,n),n+=2,i.xMin>=i.xMax||i.yMin>=i.yMax)return null;if(i.noc>0){i.endPts=[];for(var s=0;s<i.noc;s++)i.endPts.push(o.readUshort(a,n)),n+=2;var f=o.readUshort(a,n);if(n+=2,a.length-n<f)return null;i.instructions=o.readBytes(a,n,f),n+=f;var u=i.endPts[i.noc-1]+1;for(i.flags=[],s=0;s<u;s++){var h=a[n];if(n++,i.flags.push(h),(8&h)!=0){var m=a[n];n++;for(var y=0;y<m;y++)i.flags.push(h),s++}}for(i.xs=[],s=0;s<u;s++){var g=(2&i.flags[s])!=0,k=(16&i.flags[s])!=0;g?(i.xs.push(k?a[n]:-a[n]),n++):k?i.xs.push(0):(i.xs.push(o.readShort(a,n)),n+=2)}for(i.ys=[],s=0;s<u;s++)g=(4&i.flags[s])!=0,k=(32&i.flags[s])!=0,g?(i.ys.push(k?a[n]:-a[n]),n++):k?i.ys.push(0):(i.ys.push(o.readShort(a,n)),n+=2);var p=0,T=0;for(s=0;s<u;s++)p+=i.xs[s],T+=i.ys[s],i.xs[s]=p,i.ys[s]=T}else{var w;i.parts=[];do{w=o.readUshort(a,n),n+=2;var _={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(i.parts.push(_),_.glyphIndex=o.readUshort(a,n),n+=2,1&w){var S=o.readShort(a,n);n+=2;var x=o.readShort(a,n);n+=2}else S=o.readInt8(a,n),n++,x=o.readInt8(a,n),n++;2&w?(_.m.tx=S,_.m.ty=x):(_.p1=S,_.p2=x),8&w?(_.m.a=_.m.d=o.readF2dot14(a,n),n+=2):64&w?(_.m.a=o.readF2dot14(a,n),n+=2,_.m.d=o.readF2dot14(a,n),n+=2):128&w&&(_.m.a=o.readF2dot14(a,n),n+=2,_.m.b=o.readF2dot14(a,n),n+=2,_.m.c=o.readF2dot14(a,n),n+=2,_.m.d=o.readF2dot14(a,n),n+=2)}while(32&w);if(256&w){var U=o.readUshort(a,n);for(n+=2,i.instr=[],s=0;s<U;s++)i.instr.push(a[n]),n++}}return i},r.GPOS={},r.GPOS.parse=function(t,e,o,a){return r._lctf.parse(t,e,o,a,r.GPOS.subt)},r.GPOS.subt=function(t,e,o,a){var n=r._bin,i=o,s={};if(s.fmt=n.readUshort(t,o),o+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var f=n.readUshort(t,o);o+=2,s.coverage=r._lctf.readCoverage(t,f+i)}if(e==1&&s.fmt==1){var u=n.readUshort(t,o);o+=2;var h=r._lctf.numOfOnes(u);u!=0&&(s.pos=r.GPOS.readValueRecord(t,o,u))}else if(e==2&&s.fmt>=1&&s.fmt<=2){u=n.readUshort(t,o),o+=2;var m=n.readUshort(t,o);o+=2,h=r._lctf.numOfOnes(u);var y=r._lctf.numOfOnes(m);if(s.fmt==1){s.pairsets=[];var g=n.readUshort(t,o);o+=2;for(var k=0;k<g;k++){var p=i+n.readUshort(t,o);o+=2;var T=n.readUshort(t,p);p+=2;for(var w=[],_=0;_<T;_++){var S=n.readUshort(t,p);p+=2,u!=0&&(b=r.GPOS.readValueRecord(t,p,u),p+=2*h),m!=0&&(B=r.GPOS.readValueRecord(t,p,m),p+=2*y),w.push({gid2:S,val1:b,val2:B})}s.pairsets.push(w)}}if(s.fmt==2){var x=n.readUshort(t,o);o+=2;var U=n.readUshort(t,o);o+=2;var X=n.readUshort(t,o);o+=2;var K=n.readUshort(t,o);for(o+=2,s.classDef1=r._lctf.readClassDef(t,i+x),s.classDef2=r._lctf.readClassDef(t,i+U),s.matrix=[],k=0;k<X;k++){var ne=[];for(_=0;_<K;_++){var b=null,B=null;u!=0&&(b=r.GPOS.readValueRecord(t,o,u),o+=2*h),m!=0&&(B=r.GPOS.readValueRecord(t,o,m),o+=2*y),ne.push({val1:b,val2:B})}s.matrix.push(ne)}}}else{if(e==9&&s.fmt==1){var C=n.readUshort(t,o);o+=2;var j=n.readUint(t,o);if(o+=4,a.ltype==9)a.ltype=C;else if(a.ltype!=C)throw"invalid extension substitution";return r.GPOS.subt(t,a.ltype,i+j)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},r.GPOS.readValueRecord=function(t,e,o){var a=r._bin,n=[];return n.push(1&o?a.readShort(t,e):0),e+=1&o?2:0,n.push(2&o?a.readShort(t,e):0),e+=2&o?2:0,n.push(4&o?a.readShort(t,e):0),e+=4&o?2:0,n.push(8&o?a.readShort(t,e):0),e+=8&o?2:0,n},r.GSUB={},r.GSUB.parse=function(t,e,o,a){return r._lctf.parse(t,e,o,a,r.GSUB.subt)},r.GSUB.subt=function(t,e,o,a){var n=r._bin,i=o,s={};if(s.fmt=n.readUshort(t,o),o+=2,e!=1&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var f=n.readUshort(t,o);o+=2,s.coverage=r._lctf.readCoverage(t,i+f)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(t,o),o+=2;else if(s.fmt==2){var u=n.readUshort(t,o);o+=2,s.newg=n.readUshorts(t,o,u),o+=2*s.newg.length}}else if(e==4){s.vals=[],u=n.readUshort(t,o),o+=2;for(var h=0;h<u;h++){var m=n.readUshort(t,o);o+=2,s.vals.push(r.GSUB.readLigatureSet(t,i+m))}}else if(e==5&&s.fmt==2){if(s.fmt==2){var y=n.readUshort(t,o);o+=2,s.cDef=r._lctf.readClassDef(t,i+y),s.scset=[];var g=n.readUshort(t,o);for(o+=2,h=0;h<g;h++){var k=n.readUshort(t,o);o+=2,s.scset.push(k==0?null:r.GSUB.readSubClassSet(t,i+k))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(h=0;h<3;h++){u=n.readUshort(t,o),o+=2;for(var p=[],T=0;T<u;T++)p.push(r._lctf.readCoverage(t,i+n.readUshort(t,o+2*T)));o+=2*u,h==0&&(s.backCvg=p),h==1&&(s.inptCvg=p),h==2&&(s.ahedCvg=p)}u=n.readUshort(t,o),o+=2,s.lookupRec=r.GSUB.readSubstLookupRecords(t,o,u)}}else{if(e==7&&s.fmt==1){var w=n.readUshort(t,o);o+=2;var _=n.readUint(t,o);if(o+=4,a.ltype==9)a.ltype=w;else if(a.ltype!=w)throw"invalid extension substitution";return r.GSUB.subt(t,a.ltype,i+_)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},r.GSUB.readSubClassSet=function(t,e){var o=r._bin.readUshort,a=e,n=[],i=o(t,e);e+=2;for(var s=0;s<i;s++){var f=o(t,e);e+=2,n.push(r.GSUB.readSubClassRule(t,a+f))}return n},r.GSUB.readSubClassRule=function(t,e){var o=r._bin.readUshort,a={},n=o(t,e),i=o(t,e+=2);e+=2,a.input=[];for(var s=0;s<n-1;s++)a.input.push(o(t,e)),e+=2;return a.substLookupRecords=r.GSUB.readSubstLookupRecords(t,e,i),a},r.GSUB.readSubstLookupRecords=function(t,e,o){for(var a=r._bin.readUshort,n=[],i=0;i<o;i++)n.push(a(t,e),a(t,e+2)),e+=4;return n},r.GSUB.readChainSubClassSet=function(t,e){var o=r._bin,a=e,n=[],i=o.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=o.readUshort(t,e);e+=2,n.push(r.GSUB.readChainSubClassRule(t,a+f))}return n},r.GSUB.readChainSubClassRule=function(t,e){for(var o=r._bin,a={},n=["backtrack","input","lookahead"],i=0;i<n.length;i++){var s=o.readUshort(t,e);e+=2,i==1&&s--,a[n[i]]=o.readUshorts(t,e,s),e+=2*a[n[i]].length}return s=o.readUshort(t,e),e+=2,a.subst=o.readUshorts(t,e,2*s),e+=2*a.subst.length,a},r.GSUB.readLigatureSet=function(t,e){var o=r._bin,a=e,n=[],i=o.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=o.readUshort(t,e);e+=2,n.push(r.GSUB.readLigature(t,a+f))}return n},r.GSUB.readLigature=function(t,e){var o=r._bin,a={chain:[]};a.nglyph=o.readUshort(t,e),e+=2;var n=o.readUshort(t,e);e+=2;for(var i=0;i<n-1;i++)a.chain.push(o.readUshort(t,e)),e+=2;return a},r.head={},r.head.parse=function(t,e,o){var a=r._bin,n={};return a.readFixed(t,e),e+=4,n.fontRevision=a.readFixed(t,e),e+=4,a.readUint(t,e),e+=4,a.readUint(t,e),e+=4,n.flags=a.readUshort(t,e),e+=2,n.unitsPerEm=a.readUshort(t,e),e+=2,n.created=a.readUint64(t,e),e+=8,n.modified=a.readUint64(t,e),e+=8,n.xMin=a.readShort(t,e),e+=2,n.yMin=a.readShort(t,e),e+=2,n.xMax=a.readShort(t,e),e+=2,n.yMax=a.readShort(t,e),e+=2,n.macStyle=a.readUshort(t,e),e+=2,n.lowestRecPPEM=a.readUshort(t,e),e+=2,n.fontDirectionHint=a.readShort(t,e),e+=2,n.indexToLocFormat=a.readShort(t,e),e+=2,n.glyphDataFormat=a.readShort(t,e),e+=2,n},r.hhea={},r.hhea.parse=function(t,e,o){var a=r._bin,n={};return a.readFixed(t,e),e+=4,n.ascender=a.readShort(t,e),e+=2,n.descender=a.readShort(t,e),e+=2,n.lineGap=a.readShort(t,e),e+=2,n.advanceWidthMax=a.readUshort(t,e),e+=2,n.minLeftSideBearing=a.readShort(t,e),e+=2,n.minRightSideBearing=a.readShort(t,e),e+=2,n.xMaxExtent=a.readShort(t,e),e+=2,n.caretSlopeRise=a.readShort(t,e),e+=2,n.caretSlopeRun=a.readShort(t,e),e+=2,n.caretOffset=a.readShort(t,e),e+=2,e+=8,n.metricDataFormat=a.readShort(t,e),e+=2,n.numberOfHMetrics=a.readUshort(t,e),e+=2,n},r.hmtx={},r.hmtx.parse=function(t,e,o,a){for(var n=r._bin,i={aWidth:[],lsBearing:[]},s=0,f=0,u=0;u<a.maxp.numGlyphs;u++)u<a.hhea.numberOfHMetrics&&(s=n.readUshort(t,e),e+=2,f=n.readShort(t,e),e+=2),i.aWidth.push(s),i.lsBearing.push(f);return i},r.kern={},r.kern.parse=function(t,e,o,a){var n=r._bin,i=n.readUshort(t,e);if(e+=2,i==1)return r.kern.parseV1(t,e-2,o,a);var s=n.readUshort(t,e);e+=2;for(var f={glyph1:[],rval:[]},u=0;u<s;u++){e+=2,o=n.readUshort(t,e),e+=2;var h=n.readUshort(t,e);e+=2;var m=h>>>8;if((m&=15)!=0)throw"unknown kern table format: "+m;e=r.kern.readFormat0(t,e,f)}return f},r.kern.parseV1=function(t,e,o,a){var n=r._bin;n.readFixed(t,e),e+=4;var i=n.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},f=0;f<i;f++){n.readUint(t,e),e+=4;var u=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2;var h=u>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;e=r.kern.readFormat0(t,e,s)}return s},r.kern.readFormat0=function(t,e,o){var a=r._bin,n=-1,i=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2;for(var s=0;s<i;s++){var f=a.readUshort(t,e);e+=2;var u=a.readUshort(t,e);e+=2;var h=a.readShort(t,e);e+=2,f!=n&&(o.glyph1.push(f),o.rval.push({glyph2:[],vals:[]}));var m=o.rval[o.rval.length-1];m.glyph2.push(u),m.vals.push(h),n=f}return e},r.loca={},r.loca.parse=function(t,e,o,a){var n=r._bin,i=[],s=a.head.indexToLocFormat,f=a.maxp.numGlyphs+1;if(s==0)for(var u=0;u<f;u++)i.push(n.readUshort(t,e+(u<<1))<<1);if(s==1)for(u=0;u<f;u++)i.push(n.readUint(t,e+(u<<2)));return i},r.maxp={},r.maxp.parse=function(t,e,o){var a=r._bin,n={},i=a.readUint(t,e);return e+=4,n.numGlyphs=a.readUshort(t,e),e+=2,i==65536&&(n.maxPoints=a.readUshort(t,e),e+=2,n.maxContours=a.readUshort(t,e),e+=2,n.maxCompositePoints=a.readUshort(t,e),e+=2,n.maxCompositeContours=a.readUshort(t,e),e+=2,n.maxZones=a.readUshort(t,e),e+=2,n.maxTwilightPoints=a.readUshort(t,e),e+=2,n.maxStorage=a.readUshort(t,e),e+=2,n.maxFunctionDefs=a.readUshort(t,e),e+=2,n.maxInstructionDefs=a.readUshort(t,e),e+=2,n.maxStackElements=a.readUshort(t,e),e+=2,n.maxSizeOfInstructions=a.readUshort(t,e),e+=2,n.maxComponentElements=a.readUshort(t,e),e+=2,n.maxComponentDepth=a.readUshort(t,e),e+=2),n},r.name={},r.name.parse=function(t,e,o){var a=r._bin,n={};a.readUshort(t,e),e+=2;var i=a.readUshort(t,e);e+=2,a.readUshort(t,e);for(var s,f=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],u=e+=2,h=0;h<i;h++){var m=a.readUshort(t,e);e+=2;var y=a.readUshort(t,e);e+=2;var g=a.readUshort(t,e);e+=2;var k=a.readUshort(t,e);e+=2;var p=a.readUshort(t,e);e+=2;var T=a.readUshort(t,e);e+=2;var w,_=f[k],S=u+12*i+T;if(m==0)w=a.readUnicode(t,S,p/2);else if(m==3&&y==0)w=a.readUnicode(t,S,p/2);else if(y==0)w=a.readASCII(t,S,p);else if(y==1)w=a.readUnicode(t,S,p/2);else if(y==3)w=a.readUnicode(t,S,p/2);else{if(m!=1)throw"unknown encoding "+y+", platformID: "+m;w=a.readASCII(t,S,p),console.debug("reading unknown MAC encoding "+y+" as ASCII")}var x="p"+m+","+g.toString(16);n[x]==null&&(n[x]={}),n[x][_!==void 0?_:k]=w,n[x]._lang=g}for(var U in n)if(n[U].postScriptName!=null&&n[U]._lang==1033)return n[U];for(var U in n)if(n[U].postScriptName!=null&&n[U]._lang==0)return n[U];for(var U in n)if(n[U].postScriptName!=null&&n[U]._lang==3084)return n[U];for(var U in n)if(n[U].postScriptName!=null)return n[U];for(var U in n){s=U;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},r["OS/2"]={},r["OS/2"].parse=function(t,e,o){var a=r._bin.readUshort(t,e);e+=2;var n={};if(a==0)r["OS/2"].version0(t,e,n);else if(a==1)r["OS/2"].version1(t,e,n);else if(a==2||a==3||a==4)r["OS/2"].version2(t,e,n);else{if(a!=5)throw"unknown OS/2 table version: "+a;r["OS/2"].version5(t,e,n)}return n},r["OS/2"].version0=function(t,e,o){var a=r._bin;return o.xAvgCharWidth=a.readShort(t,e),e+=2,o.usWeightClass=a.readUshort(t,e),e+=2,o.usWidthClass=a.readUshort(t,e),e+=2,o.fsType=a.readUshort(t,e),e+=2,o.ySubscriptXSize=a.readShort(t,e),e+=2,o.ySubscriptYSize=a.readShort(t,e),e+=2,o.ySubscriptXOffset=a.readShort(t,e),e+=2,o.ySubscriptYOffset=a.readShort(t,e),e+=2,o.ySuperscriptXSize=a.readShort(t,e),e+=2,o.ySuperscriptYSize=a.readShort(t,e),e+=2,o.ySuperscriptXOffset=a.readShort(t,e),e+=2,o.ySuperscriptYOffset=a.readShort(t,e),e+=2,o.yStrikeoutSize=a.readShort(t,e),e+=2,o.yStrikeoutPosition=a.readShort(t,e),e+=2,o.sFamilyClass=a.readShort(t,e),e+=2,o.panose=a.readBytes(t,e,10),e+=10,o.ulUnicodeRange1=a.readUint(t,e),e+=4,o.ulUnicodeRange2=a.readUint(t,e),e+=4,o.ulUnicodeRange3=a.readUint(t,e),e+=4,o.ulUnicodeRange4=a.readUint(t,e),e+=4,o.achVendID=[a.readInt8(t,e),a.readInt8(t,e+1),a.readInt8(t,e+2),a.readInt8(t,e+3)],e+=4,o.fsSelection=a.readUshort(t,e),e+=2,o.usFirstCharIndex=a.readUshort(t,e),e+=2,o.usLastCharIndex=a.readUshort(t,e),e+=2,o.sTypoAscender=a.readShort(t,e),e+=2,o.sTypoDescender=a.readShort(t,e),e+=2,o.sTypoLineGap=a.readShort(t,e),e+=2,o.usWinAscent=a.readUshort(t,e),e+=2,o.usWinDescent=a.readUshort(t,e),e+=2},r["OS/2"].version1=function(t,e,o){var a=r._bin;return e=r["OS/2"].version0(t,e,o),o.ulCodePageRange1=a.readUint(t,e),e+=4,o.ulCodePageRange2=a.readUint(t,e),e+=4},r["OS/2"].version2=function(t,e,o){var a=r._bin;return e=r["OS/2"].version1(t,e,o),o.sxHeight=a.readShort(t,e),e+=2,o.sCapHeight=a.readShort(t,e),e+=2,o.usDefault=a.readUshort(t,e),e+=2,o.usBreak=a.readUshort(t,e),e+=2,o.usMaxContext=a.readUshort(t,e),e+=2},r["OS/2"].version5=function(t,e,o){var a=r._bin;return e=r["OS/2"].version2(t,e,o),o.usLowerOpticalPointSize=a.readUshort(t,e),e+=2,o.usUpperOpticalPointSize=a.readUshort(t,e),e+=2},r.post={},r.post.parse=function(t,e,o){var a=r._bin,n={};return n.version=a.readFixed(t,e),e+=4,n.italicAngle=a.readFixed(t,e),e+=4,n.underlinePosition=a.readShort(t,e),e+=2,n.underlineThickness=a.readShort(t,e),e+=2,n},r==null&&(r={}),r.U==null&&(r.U={}),r.U.codeToGlyph=function(t,e){var o=t.cmap,a=-1;if(o.p0e4!=null?a=o.p0e4:o.p3e1!=null?a=o.p3e1:o.p1e0!=null?a=o.p1e0:o.p0e3!=null&&(a=o.p0e3),a==-1)throw"no familiar platform and encoding!";var n=o.tables[a];if(n.format==0)return e>=n.map.length?0:n.map[e];if(n.format==4){for(var i=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){i=s;break}return i==-1||n.startCount[i]>e?0:65535&(n.idRangeOffset[i]!=0?n.glyphIdArray[e-n.startCount[i]+(n.idRangeOffset[i]>>1)-(n.idRangeOffset.length-i)]:e+n.idDelta[i])}if(n.format==12){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var f=n.groups[s];if(f[0]<=e&&e<=f[1])return f[2]+(e-f[0])}return 0}throw"unknown cmap table format "+n.format},r.U.glyphToPath=function(t,e){var o={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var a=t.SVG.entries[e];return a==null?o:(typeof a=="string"&&(a=r.SVG.toPath(a),t.SVG.entries[e]=a),a)}if(t.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},i=t.CFF,s=t.CFF.Private;if(i.ROS){for(var f=0;i.FDSelect[f+2]<=e;)f+=2;s=i.FDArray[i.FDSelect[f+1]].Private}r.U._drawCFF(t.CFF.CharStrings[e],n,i,s,o)}else t.glyf&&r.U._drawGlyf(e,t,o);return o},r.U._drawGlyf=function(t,e,o){var a=e.glyf[t];a==null&&(a=e.glyf[t]=r.glyf._parseGlyf(e,t)),a!=null&&(a.noc>-1?r.U._simpleGlyph(a,o):r.U._compoGlyph(a,e,o))},r.U._simpleGlyph=function(t,e){for(var o=0;o<t.noc;o++){for(var a=o==0?0:t.endPts[o-1]+1,n=t.endPts[o],i=a;i<=n;i++){var s=i==a?n:i-1,f=i==n?a:i+1,u=1&t.flags[i],h=1&t.flags[s],m=1&t.flags[f],y=t.xs[i],g=t.ys[i];if(i==a)if(u){if(!h){r.U.P.moveTo(e,y,g);continue}r.U.P.moveTo(e,t.xs[s],t.ys[s])}else h?r.U.P.moveTo(e,t.xs[s],t.ys[s]):r.U.P.moveTo(e,(t.xs[s]+y)/2,(t.ys[s]+g)/2);u?h&&r.U.P.lineTo(e,y,g):m?r.U.P.qcurveTo(e,y,g,t.xs[f],t.ys[f]):r.U.P.qcurveTo(e,y,g,(y+t.xs[f])/2,(g+t.ys[f])/2)}r.U.P.closePath(e)}},r.U._compoGlyph=function(t,e,o){for(var a=0;a<t.parts.length;a++){var n={cmds:[],crds:[]},i=t.parts[a];r.U._drawGlyf(i.glyphIndex,e,n);for(var s=i.m,f=0;f<n.crds.length;f+=2){var u=n.crds[f],h=n.crds[f+1];o.crds.push(u*s.a+h*s.b+s.tx),o.crds.push(u*s.c+h*s.d+s.ty)}for(f=0;f<n.cmds.length;f++)o.cmds.push(n.cmds[f])}},r.U._getGlyphClass=function(t,e){var o=r._lctf.getInterval(e,t);return o==-1?0:e[o+2]},r.U.getPairAdjustment=function(t,e,o){var a=!1;if(t.GPOS)for(var n=t.GPOS,i=n.lookupList,s=n.featureList,f=[],u=0;u<s.length;u++){var h=s[u];if(h.tag=="kern"){a=!0;for(var m=0;m<h.tab.length;m++)if(!f[h.tab[m]]){f[h.tab[m]]=!0;for(var y=i[h.tab[m]],g=0;g<y.tabs.length;g++)if(y.tabs[g]!=null){var k,p=y.tabs[g];if((!p.coverage||(k=r._lctf.coverageIndex(p.coverage,e))!=-1)&&y.ltype!=1){if(y.ltype==2){var T=null;if(p.fmt==1){var w=p.pairsets[k];for(u=0;u<w.length;u++)w[u].gid2==o&&(T=w[u])}else if(p.fmt==2){var _=r.U._getGlyphClass(e,p.classDef1),S=r.U._getGlyphClass(o,p.classDef2);T=p.matrix[_][S]}if(T){var x=0;return T.val1&&T.val1[2]&&(x+=T.val1[2]),T.val2&&T.val2[0]&&(x+=T.val2[0]),x}}}}}}}if(t.kern&&!a){var U=t.kern.glyph1.indexOf(e);if(U!=-1){var X=t.kern.rval[U].glyph2.indexOf(o);if(X!=-1)return t.kern.rval[U].vals[X]}}return 0},r.U._applySubs=function(t,e,o,a){for(var n=t.length-e-1,i=0;i<o.tabs.length;i++)if(o.tabs[i]!=null){var s,f=o.tabs[i];if(!f.coverage||(s=r._lctf.coverageIndex(f.coverage,t[e]))!=-1){if(o.ltype==1)t[e],f.fmt==1?t[e]=t[e]+f.delta:t[e]=f.newg[s];else if(o.ltype==4)for(var u=f.vals[s],h=0;h<u.length;h++){var m=u[h],y=m.chain.length;if(!(y>n)){for(var g=!0,k=0,p=0;p<y;p++){for(;t[e+k+(1+p)]==-1;)k++;m.chain[p]!=t[e+k+(1+p)]&&(g=!1)}if(g){for(t[e]=m.nglyph,p=0;p<y+k;p++)t[e+p+1]=-1;break}}}else if(o.ltype==5&&f.fmt==2)for(var T=r._lctf.getInterval(f.cDef,t[e]),w=f.cDef[T+2],_=f.scset[w],S=0;S<_.length;S++){var x=_[S],U=x.input;if(!(U.length>n)){for(g=!0,p=0;p<U.length;p++){var X=r._lctf.getInterval(f.cDef,t[e+1+p]);if(T==-1&&f.cDef[X+2]!=U[p]){g=!1;break}}if(g){var K=x.substLookupRecords;for(h=0;h<K.length;h+=2)K[h],K[h+1]}}}else if(o.ltype==6&&f.fmt==3){if(!r.U._glsCovered(t,f.backCvg,e-f.backCvg.length)||!r.U._glsCovered(t,f.inptCvg,e)||!r.U._glsCovered(t,f.ahedCvg,e+f.inptCvg.length))continue;var ne=f.lookupRec;for(S=0;S<ne.length;S+=2){T=ne[S];var b=a[ne[S+1]];r.U._applySubs(t,e+T,b,a)}}}}},r.U._glsCovered=function(t,e,o){for(var a=0;a<e.length;a++)if(r._lctf.coverageIndex(e[a],t[o+a])==-1)return!1;return!0},r.U.glyphsToPath=function(t,e,o){for(var a={cmds:[],crds:[]},n=0,i=0;i<e.length;i++){var s=e[i];if(s!=-1){for(var f=i<e.length-1&&e[i+1]!=-1?e[i+1]:0,u=r.U.glyphToPath(t,s),h=0;h<u.crds.length;h+=2)a.crds.push(u.crds[h]+n),a.crds.push(u.crds[h+1]);for(o&&a.cmds.push(o),h=0;h<u.cmds.length;h++)a.cmds.push(u.cmds[h]);o&&a.cmds.push("X"),n+=t.hmtx.aWidth[s],i<e.length-1&&(n+=r.U.getPairAdjustment(t,s,f))}}return a},r.U.P={},r.U.P.moveTo=function(t,e,o){t.cmds.push("M"),t.crds.push(e,o)},r.U.P.lineTo=function(t,e,o){t.cmds.push("L"),t.crds.push(e,o)},r.U.P.curveTo=function(t,e,o,a,n,i,s){t.cmds.push("C"),t.crds.push(e,o,a,n,i,s)},r.U.P.qcurveTo=function(t,e,o,a,n){t.cmds.push("Q"),t.crds.push(e,o,a,n)},r.U.P.closePath=function(t){t.cmds.push("Z")},r.U._drawCFF=function(t,e,o,a,n){for(var i=e.stack,s=e.nStems,f=e.haveWidth,u=e.width,h=e.open,m=0,y=e.x,g=e.y,k=0,p=0,T=0,w=0,_=0,S=0,x=0,U=0,X=0,K=0,ne={val:0,size:0};m<t.length;){r.CFF.getCharString(t,m,ne);var b=ne.val;if(m+=ne.size,b=="o1"||b=="o18")i.length%2!=0&&!f&&(u=i.shift()+a.nominalWidthX),s+=i.length>>1,i.length=0,f=!0;else if(b=="o3"||b=="o23")i.length%2!=0&&!f&&(u=i.shift()+a.nominalWidthX),s+=i.length>>1,i.length=0,f=!0;else if(b=="o4")i.length>1&&!f&&(u=i.shift()+a.nominalWidthX,f=!0),h&&r.U.P.closePath(n),g+=i.pop(),r.U.P.moveTo(n,y,g),h=!0;else if(b=="o5")for(;i.length>0;)y+=i.shift(),g+=i.shift(),r.U.P.lineTo(n,y,g);else if(b=="o6"||b=="o7")for(var B=i.length,C=b=="o6",j=0;j<B;j++){var N=i.shift();C?y+=N:g+=N,C=!C,r.U.P.lineTo(n,y,g)}else if(b=="o8"||b=="o24"){B=i.length;for(var le=0;le+6<=B;)k=y+i.shift(),p=g+i.shift(),T=k+i.shift(),w=p+i.shift(),y=T+i.shift(),g=w+i.shift(),r.U.P.curveTo(n,k,p,T,w,y,g),le+=6;b=="o24"&&(y+=i.shift(),g+=i.shift(),r.U.P.lineTo(n,y,g))}else{if(b=="o11")break;if(b=="o1234"||b=="o1235"||b=="o1236"||b=="o1237")b=="o1234"&&(p=g,T=(k=y+i.shift())+i.shift(),K=w=p+i.shift(),S=w,U=g,y=(x=(_=(X=T+i.shift())+i.shift())+i.shift())+i.shift(),r.U.P.curveTo(n,k,p,T,w,X,K),r.U.P.curveTo(n,_,S,x,U,y,g)),b=="o1235"&&(k=y+i.shift(),p=g+i.shift(),T=k+i.shift(),w=p+i.shift(),X=T+i.shift(),K=w+i.shift(),_=X+i.shift(),S=K+i.shift(),x=_+i.shift(),U=S+i.shift(),y=x+i.shift(),g=U+i.shift(),i.shift(),r.U.P.curveTo(n,k,p,T,w,X,K),r.U.P.curveTo(n,_,S,x,U,y,g)),b=="o1236"&&(k=y+i.shift(),p=g+i.shift(),T=k+i.shift(),K=w=p+i.shift(),S=w,x=(_=(X=T+i.shift())+i.shift())+i.shift(),U=S+i.shift(),y=x+i.shift(),r.U.P.curveTo(n,k,p,T,w,X,K),r.U.P.curveTo(n,_,S,x,U,y,g)),b=="o1237"&&(k=y+i.shift(),p=g+i.shift(),T=k+i.shift(),w=p+i.shift(),X=T+i.shift(),K=w+i.shift(),_=X+i.shift(),S=K+i.shift(),x=_+i.shift(),U=S+i.shift(),Math.abs(x-y)>Math.abs(U-g)?y=x+i.shift():g=U+i.shift(),r.U.P.curveTo(n,k,p,T,w,X,K),r.U.P.curveTo(n,_,S,x,U,y,g));else if(b=="o14"){if(i.length>0&&!f&&(u=i.shift()+o.nominalWidthX,f=!0),i.length==4){var ie=i.shift(),D=i.shift(),W=i.shift(),v=i.shift(),E=r.CFF.glyphBySE(o,W),G=r.CFF.glyphBySE(o,v);r.U._drawCFF(o.CharStrings[E],e,o,a,n),e.x=ie,e.y=D,r.U._drawCFF(o.CharStrings[G],e,o,a,n)}h&&(r.U.P.closePath(n),h=!1)}else if(b=="o19"||b=="o20")i.length%2!=0&&!f&&(u=i.shift()+a.nominalWidthX),s+=i.length>>1,i.length=0,f=!0,m+=s+7>>3;else if(b=="o21")i.length>2&&!f&&(u=i.shift()+a.nominalWidthX,f=!0),g+=i.pop(),y+=i.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,y,g),h=!0;else if(b=="o22")i.length>1&&!f&&(u=i.shift()+a.nominalWidthX,f=!0),y+=i.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,y,g),h=!0;else if(b=="o25"){for(;i.length>6;)y+=i.shift(),g+=i.shift(),r.U.P.lineTo(n,y,g);k=y+i.shift(),p=g+i.shift(),T=k+i.shift(),w=p+i.shift(),y=T+i.shift(),g=w+i.shift(),r.U.P.curveTo(n,k,p,T,w,y,g)}else if(b=="o26")for(i.length%2&&(y+=i.shift());i.length>0;)k=y,p=g+i.shift(),y=T=k+i.shift(),g=(w=p+i.shift())+i.shift(),r.U.P.curveTo(n,k,p,T,w,y,g);else if(b=="o27")for(i.length%2&&(g+=i.shift());i.length>0;)p=g,T=(k=y+i.shift())+i.shift(),w=p+i.shift(),y=T+i.shift(),g=w,r.U.P.curveTo(n,k,p,T,w,y,g);else if(b=="o10"||b=="o29"){var P=b=="o10"?a:o;if(i.length==0)console.debug("error: empty stack");else{var F=i.pop(),I=P.Subrs[F+P.Bias];e.x=y,e.y=g,e.nStems=s,e.haveWidth=f,e.width=u,e.open=h,r.U._drawCFF(I,e,o,a,n),y=e.x,g=e.y,s=e.nStems,f=e.haveWidth,u=e.width,h=e.open}}else if(b=="o30"||b=="o31"){var A=i.length,R=(le=0,b=="o31");for(le+=A-(B=-3&A);le<B;)R?(p=g,T=(k=y+i.shift())+i.shift(),g=(w=p+i.shift())+i.shift(),B-le==5?(y=T+i.shift(),le++):y=T,R=!1):(k=y,p=g+i.shift(),T=k+i.shift(),w=p+i.shift(),y=T+i.shift(),B-le==5?(g=w+i.shift(),le++):g=w,R=!0),r.U.P.curveTo(n,k,p,T,w,y,g),le+=4}else{if((b+"").charAt(0)=="o")throw console.debug("Unknown operation: "+b,t),b;i.push(b)}}}e.x=y,e.y=g,e.nStems=s,e.haveWidth=f,e.width=u,e.open=h};var d=r,c={Typr:d};return l.Typr=d,l.default=c,Object.defineProperty(l,"__esModule",{value:!0}),l}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering.
Original licenses apply:
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function qn(){return function(l){var r=Uint8Array,d=Uint16Array,c=Uint32Array,t=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(b,B){for(var C=new d(31),j=0;j<31;++j)C[j]=B+=1<<b[j-1];var N=new c(C[30]);for(j=1;j<30;++j)for(var le=C[j];le<C[j+1];++le)N[le]=le-C[j]<<5|j;return[C,N]},n=a(t,2),i=n[0],s=n[1];i[28]=258,s[258]=28;for(var f=a(e,0)[0],u=new d(32768),h=0;h<32768;++h){var m=(43690&h)>>>1|(21845&h)<<1;m=(61680&(m=(52428&m)>>>2|(13107&m)<<2))>>>4|(3855&m)<<4,u[h]=((65280&m)>>>8|(255&m)<<8)>>>1}var y=function(b,B,C){for(var j=b.length,N=0,le=new d(B);N<j;++N)++le[b[N]-1];var ie,D=new d(B);for(N=0;N<B;++N)D[N]=D[N-1]+le[N-1]<<1;if(C){ie=new d(1<<B);var W=15-B;for(N=0;N<j;++N)if(b[N])for(var v=N<<4|b[N],E=B-b[N],G=D[b[N]-1]++<<E,P=G|(1<<E)-1;G<=P;++G)ie[u[G]>>>W]=v}else for(ie=new d(j),N=0;N<j;++N)b[N]&&(ie[N]=u[D[b[N]-1]++]>>>15-b[N]);return ie},g=new r(288);for(h=0;h<144;++h)g[h]=8;for(h=144;h<256;++h)g[h]=9;for(h=256;h<280;++h)g[h]=7;for(h=280;h<288;++h)g[h]=8;var k=new r(32);for(h=0;h<32;++h)k[h]=5;var p=y(g,9,1),T=y(k,5,1),w=function(b){for(var B=b[0],C=1;C<b.length;++C)b[C]>B&&(B=b[C]);return B},_=function(b,B,C){var j=B/8|0;return(b[j]|b[j+1]<<8)>>(7&B)&C},S=function(b,B){var C=B/8|0;return(b[C]|b[C+1]<<8|b[C+2]<<16)>>(7&B)},x=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],U=function(b,B,C){var j=new Error(B||x[b]);if(j.code=b,Error.captureStackTrace&&Error.captureStackTrace(j,U),!C)throw j;return j},X=function(b,B,C){var j=b.length;if(!j||C&&!C.l&&j<5)return B||new r(0);var N=!B||C,le=!C||C.i;C||(C={}),B||(B=new r(3*j));var ie,D=function(oe){var _e=B.length;if(oe>_e){var Se=new r(Math.max(2*_e,oe));Se.set(B),B=Se}},W=C.f||0,v=C.p||0,E=C.b||0,G=C.l,P=C.d,F=C.m,I=C.n,A=8*j;do{if(!G){C.f=W=_(b,v,1);var R=_(b,v+1,3);if(v+=3,!R){var z=b[(Y=((ie=v)/8|0)+(7&ie&&1)+4)-4]|b[Y-3]<<8,q=Y+z;if(q>j){le&&U(0);break}N&&D(E+z),B.set(b.subarray(Y,q),E),C.b=E+=z,C.p=v=8*q;continue}if(R==1)G=p,P=T,F=9,I=5;else if(R==2){var V=_(b,v,31)+257,M=_(b,v+10,15)+4,ve=V+_(b,v+5,31)+1;v+=14;for(var he=new r(ve),H=new r(19),$=0;$<M;++$)H[o[$]]=_(b,v+3*$,7);v+=3*M;var fe=w(H),L=(1<<fe)-1,te=y(H,fe,1);for($=0;$<ve;){var Y,O=te[_(b,v,L)];if(v+=15&O,(Y=O>>>4)<16)he[$++]=Y;else{var ae=0,Q=0;for(Y==16?(Q=3+_(b,v,3),v+=2,ae=he[$-1]):Y==17?(Q=3+_(b,v,7),v+=3):Y==18&&(Q=11+_(b,v,127),v+=7);Q--;)he[$++]=ae}}var re=he.subarray(0,V),J=he.subarray(V);F=w(re),I=w(J),G=y(re,F,1),P=y(J,I,1)}else U(1);if(v>A){le&&U(0);break}}N&&D(E+131072);for(var be=(1<<F)-1,me=(1<<I)-1,ee=v;;ee=v){var ce=(ae=G[S(b,v)&be])>>>4;if((v+=15&ae)>A){le&&U(0);break}if(ae||U(2),ce<256)B[E++]=ce;else{if(ce==256){ee=v,G=null;break}var ye=ce-254;if(ce>264){var Me=t[$=ce-257];ye=_(b,v,(1<<Me)-1)+i[$],v+=Me}var ue=P[S(b,v)&me],xe=ue>>>4;if(ue||U(3),v+=15&ue,J=f[xe],xe>3&&(Me=e[xe],J+=S(b,v)&(1<<Me)-1,v+=Me),v>A){le&&U(0);break}N&&D(E+131072);for(var pe=E+ye;E<pe;E+=4)B[E]=B[E-J],B[E+1]=B[E+1-J],B[E+2]=B[E+2-J],B[E+3]=B[E+3-J];E=pe}}C.l=G,C.p=ee,C.b=E,G&&(W=1,C.m=F,C.d=P,C.n=I)}while(!W);return E==B.length?B:function(oe,_e,Se){(_e==null||_e<0)&&(_e=0),(Se==null||Se>oe.length)&&(Se=oe.length);var Re=new(oe instanceof d?d:oe instanceof c?c:r)(Se-_e);return Re.set(oe.subarray(_e,Se)),Re}(B,0,E)},K=new r(0),ne=typeof TextDecoder<"u"&&new TextDecoder;try{ne.decode(K,{stream:!0})}catch{}return l.convert_streams=function(b){var B=new DataView(b),C=0;function j(){var V=B.getUint16(C);return C+=2,V}function N(){var V=B.getUint32(C);return C+=4,V}function le(V){z.setUint16(q,V),q+=2}function ie(V){z.setUint32(q,V),q+=4}for(var D={signature:N(),flavor:N(),length:N(),numTables:j(),reserved:j(),totalSfntSize:N(),majorVersion:j(),minorVersion:j(),metaOffset:N(),metaLength:N(),metaOrigLength:N(),privOffset:N(),privLength:N()},W=0;Math.pow(2,W)<=D.numTables;)W++;W--;for(var v=16*Math.pow(2,W),E=16*D.numTables-v,G=12,P=[],F=0;F<D.numTables;F++)P.push({tag:N(),offset:N(),compLength:N(),origLength:N(),origChecksum:N()}),G+=16;var I,A=new Uint8Array(12+16*P.length+P.reduce(function(V,M){return V+M.origLength+4},0)),R=A.buffer,z=new DataView(R),q=0;return ie(D.flavor),le(D.numTables),le(v),le(W),le(E),P.forEach(function(V){ie(V.tag),ie(V.origChecksum),ie(G),ie(V.origLength),V.outOffset=G,(G+=V.origLength)%4!=0&&(G+=4-G%4)}),P.forEach(function(V){var M,ve=b.slice(V.offset,V.offset+V.compLength);if(V.compLength!=V.origLength){var he=new Uint8Array(V.origLength);M=new Uint8Array(ve,2),X(M,he)}else he=new Uint8Array(ve);A.set(he,V.outOffset);var H=0;(G=V.outOffset+V.origLength)%4!=0&&(H=4-G%4),A.set(new Uint8Array(H).buffer,V.outOffset+V.origLength),I=G+H}),R.slice(0,I)},Object.defineProperty(l,"__esModule",{value:!0}),l}({}).convert_streams}function $n(l,r){const d={M:2,L:2,Q:4,C:6,Z:0},c={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,o=4,a=8,n=16,i=32;let s;function f(_){if(!s){const S={R:e,L:t,D:o,C:n,U:i,T:a};s=new Map;for(let x in c){let U=0;c[x].split(",").forEach(X=>{let[K,ne]=X.split("+");K=parseInt(K,36),ne=ne?parseInt(ne,36):0,s.set(U+=K,S[x]);for(let b=ne;b--;)s.set(++U,S[x])})}}return s.get(_)||i}const u=1,h=2,m=3,y=4,g=[null,"isol","init","fina","medi"];function k(_){const S=new Uint8Array(_.length);let x=i,U=u,X=-1;for(let K=0;K<_.length;K++){const ne=_.codePointAt(K);let b=f(ne)|0,B=u;b&a||(x&(t|o|n)?b&(e|o|n)?(B=m,(U===u||U===m)&&S[X]++):b&(t|i)&&(U===h||U===y)&&S[X]--:x&(e|i)&&(U===h||U===y)&&S[X]--,U=S[K]=B,x=b,X=K,ne>65535&&K++)}return S}function p(_,S){const x=[];for(let X=0;X<S.length;X++){const K=S.codePointAt(X);K>65535&&X++,x.push(l.U.codeToGlyph(_,K))}const U=_.GSUB;if(U){const{lookupList:X,featureList:K}=U;let ne;const b=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,B=[];K.forEach(C=>{if(b.test(C.tag))for(let j=0;j<C.tab.length;j++){if(B[C.tab[j]])continue;B[C.tab[j]]=!0;const N=X[C.tab[j]],le=/^(isol|init|fina|medi)$/.test(C.tag);le&&!ne&&(ne=k(S));for(let ie=0;ie<x.length;ie++)(!ne||!le||g[ne[ie]]===C.tag)&&l.U._applySubs(x,ie,N,X)}})}return x}function T(..._){for(let S=0;S<_.length;S++)if(typeof _[S]=="number")return _[S]}function w(_){const S=Object.create(null),x=_["OS/2"],U=_.hhea,X=_.head.unitsPerEm,K=T(x&&x.sTypoAscender,U&&U.ascender,X),ne={unitsPerEm:X,ascender:K,descender:T(x&&x.sTypoDescender,U&&U.descender,0),capHeight:T(x&&x.sCapHeight,K),xHeight:T(x&&x.sxHeight,K),lineGap:T(x&&x.sTypoLineGap,U&&U.lineGap),forEachGlyph(b,B,C,j){let N=0;const le=1/ne.unitsPerEm*B,ie=p(_,b);let D=0,W=-1;return ie.forEach((v,E)=>{if(v!==-1){let G=S[v];if(!G){const{cmds:P,crds:F}=l.U.glyphToPath(_,v);let I="",A=0;for(let M=0,ve=P.length;M<ve;M++){const he=d[P[M]];I+=P[M];for(let H=1;H<=he;H++)I+=(H>1?",":"")+F[A++]}let R,z,q,V;if(F.length){R=z=1/0,q=V=-1/0;for(let M=0,ve=F.length;M<ve;M+=2){let he=F[M],H=F[M+1];he<R&&(R=he),H<z&&(z=H),he>q&&(q=he),H>V&&(V=H)}}else R=q=z=V=0;G=S[v]={index:v,advanceWidth:_.hmtx.aWidth[v],xMin:R,yMin:z,xMax:q,yMax:V,path:I,pathCommandCount:P.length}}W!==-1&&(N+=l.U.getPairAdjustment(_,W,v)*le),j.call(null,G,N,D),G.advanceWidth&&(N+=G.advanceWidth*le),C&&(N+=C*B),W=v}D+=b.codePointAt(D)>65535?2:1}),N}};return ne}return function(S){const x=new Uint8Array(S,0,4),U=l._bin.readASCII(x,0,4);if(U==="wOFF")S=r(S);else if(U==="wOF2")throw new Error("woff2 fonts not supported");return w(l.parse(S)[0])}}const ea=mt({name:"Typr Font Parser",dependencies:[Zn,qn,$n],init(l,r,d){const c=l(),t=r();return d(c,t)}}),ft={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},ta=new AFRAME.THREE.Color;function ut(){return(self.performance||Date).now()}const Xr=Object.create(null);function ra(l,r){l=aa({},l);const d=ut();if(l.font=oa(l.font||ft.defaultFontURL),l.text=""+l.text,l.sdfGlyphSize=l.sdfGlyphSize||ft.sdfGlyphSize,l.colorRanges!=null){let f={};for(let u in l.colorRanges)if(l.colorRanges.hasOwnProperty(u)){let h=l.colorRanges[u];typeof h!="number"&&(h=ta.set(h).getHex()),f[u]=h}l.colorRanges=f}Object.freeze(l);const{textureWidth:c,sdfExponent:t}=ft,{sdfGlyphSize:e}=l,o=c/e*4;let a=Xr[e];if(!a){const f=at.createElement("canvas");f.width=c,f.height=e*256/o,a=Xr[e]={glyphCount:0,sdfGlyphSize:e,sdfCanvas:f,sdfTexture:new AFRAME.THREE.Texture(f,void 0,void 0,void 0,AFRAME.THREE.LinearFilter,AFRAME.THREE.LinearFilter),contextLost:!1,glyphsByFont:new Map},a.sdfTexture.generateMipmaps=!1,na(a)}const{sdfTexture:n,sdfCanvas:i}=a;let s=a.glyphsByFont.get(l.font);s||a.glyphsByFont.set(l.font,s=new Map),ia(l).then(f=>{const{glyphIds:u,glyphPositions:h,fontSize:m,unitsPerEm:y,timings:g}=f,k=[],p=new Float32Array(u.length*4),T=m/y;let w=0,_=0;const S=ut();u.forEach((ne,b)=>{let B=s.get(ne);if(!B){const{path:le,pathBounds:ie}=f.glyphData[ne],D=Math.max(ie[2]-ie[0],ie[3]-ie[1])/e*(ft.sdfMargin*e+.5),W=a.glyphCount++,v=[ie[0]-D,ie[1]-D,ie[2]+D,ie[3]+D];s.set(ne,B={path:le,atlasIndex:W,sdfViewBox:v}),k.push(B)}const{sdfViewBox:C}=B,j=h[_++],N=h[_++];p[w++]=j+C[0]*T,p[w++]=N+C[1]*T,p[w++]=j+C[2]*T,p[w++]=N+C[3]*T,u[b]=B.atlasIndex}),g.quads=(g.quads||0)+(ut()-S);const x=ut();g.sdf={};const U=i.height,X=Math.ceil(a.glyphCount/o),K=Math.pow(2,Math.ceil(Math.log2(X*e)));K>U&&(console.info(`Increasing SDF texture size ${U}->${K}`),Qn(i,c,K),n.dispose()),Promise.all(k.map(ne=>Yr(ne,a,l.gpuAccelerateSDF).then(({timing:b})=>{g.sdf[ne.atlasIndex]=b}))).then(()=>{k.length&&!a.contextLost&&(Jr(a),n.needsUpdate=!0),g.sdfTotal=ut()-x,g.total=ut()-d,r(Object.freeze({parameters:l,sdfTexture:n,sdfGlyphSize:e,sdfExponent:t,glyphBounds:p,glyphAtlasIndices:u,glyphColors:f.glyphColors,caretPositions:f.caretPositions,caretHeight:f.caretHeight,chunkedBounds:f.chunkedBounds,ascender:f.ascender,descender:f.descender,lineHeight:f.lineHeight,capHeight:f.capHeight,xHeight:f.xHeight,topBaseline:f.topBaseline,blockBounds:f.blockBounds,visibleBounds:f.visibleBounds,timings:f.timings}))})}),Promise.resolve().then(()=>{a.contextLost||Kn(i)})}function Yr({path:l,atlasIndex:r,sdfViewBox:d},{sdfGlyphSize:c,sdfCanvas:t,contextLost:e},o){if(e)return Promise.resolve({timing:-1});const{textureWidth:a,sdfExponent:n}=ft,i=Math.max(d[2]-d[0],d[3]-d[1]),s=Math.floor(r/4),f=s%(a/c)*c,u=Math.floor(s/(a/c))*c,h=r%4;return Vn(c,c,l,d,i,n,t,f,u,h,o)}function na(l){const r=l.sdfCanvas;r.addEventListener("webglcontextlost",d=>{console.log("Context Lost",d),d.preventDefault(),l.contextLost=!0}),r.addEventListener("webglcontextrestored",d=>{console.log("Context Restored",d),l.contextLost=!1;const c=[];l.glyphsByFont.forEach(t=>{t.forEach(e=>{c.push(Yr(e,l,!0))})}),Promise.all(c).then(()=>{Jr(l),l.sdfTexture.needsUpdate=!0})})}function aa(l,r){for(let d in r)r.hasOwnProperty(d)&&(l[d]=r[d]);return l}let Gt;function oa(l){return Gt||(Gt=typeof at>"u"?{}:at.createElement("a")),Gt.href=l,Gt.href}function Jr(l){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:r,sdfTexture:d}=l,{width:c,height:t}=r,e=l.sdfCanvas.getContext("webgl");let o=d.image.data;(!o||o.length!==c*t*4)&&(o=new Uint8Array(c*t*4),d.image={width:c,height:t,data:o},d.flipY=!1,d.isDataTexture=!0),e.readPixels(0,0,c,t,e.RGBA,e.UNSIGNED_BYTE,o)}}const ia=mt({name:"Typesetter",dependencies:[mt({name:"Typesetter",dependencies:[ft,ea,zn,On],init(l,r,d,c){const{defaultFontURL:t}=l;return d(r,c(),{defaultFontURL:t})}})],init(l){return function(r){return new Promise(d=>{l.typeset(r,d)})}},getTransferables(l){const r=[l.glyphPositions.buffer,l.glyphIds.buffer];return l.caretPositions&&r.push(l.caretPositions.buffer),l.glyphColors&&r.push(l.glyphColors.buffer),r}}),Kr={};function sa(l){let r=Kr[l];if(!r){const d=new AFRAME.THREE.PlaneGeometry(1,1,l,l),c=d.clone(),t=d.attributes,e=c.attributes,o=new AFRAME.THREE.BufferGeometry,a=t.uv.count;for(let n=0;n<a;n++)e.position.array[n*3]*=-1,e.normal.array[n*3+2]*=-1;["position","normal","uv"].forEach(n=>{o.setAttribute(n,new AFRAME.THREE.Float32BufferAttribute([...t[n].array,...e[n].array],t[n].itemSize))}),o.setIndex([...d.index.array,...c.index.array.map(n=>n+a)]),o.translate(.5,.5,0),r=Kr[l]=o}return r}const la="aTroikaGlyphBounds",Qr="aTroikaGlyphIndex",fa="aTroikaGlyphColor";class ua extends AFRAME.THREE.InstancedBufferGeometry{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new AFRAME.THREE.Sphere,this.boundingBox=new AFRAME.THREE.Box3}computeBoundingSphere(){}computeBoundingBox(){}setSide(r){const d=this.getIndex().count;this.setDrawRange(r===AFRAME.THREE.BackSide?d/2:0,r===AFRAME.THREE.DoubleSide?d:d/2)}set detail(r){if(r!==this._detail){this._detail=r,(typeof r!="number"||r<1)&&(r=1);let d=sa(r);["position","normal","uv"].forEach(c=>{this.attributes[c]=d.attributes[c].clone()}),this.setIndex(d.getIndex().clone())}}get detail(){return this._detail}set curveRadius(r){r!==this._curveRadius&&(this._curveRadius=r,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(r,d,c,t,e){ir(this,la,r,4),ir(this,Qr,d,1),ir(this,fa,e,3),this._blockBounds=c,this._chunkedBounds=t,this.instanceCount=d.length,this._updateBounds()}_updateBounds(){const r=this._blockBounds;if(r){const{curveRadius:d,boundingBox:c}=this;if(d){const{PI:t,floor:e,min:o,max:a,sin:n,cos:i}=Math,s=t/2,f=t*2,u=Math.abs(d),h=r[0]/u,m=r[2]/u,y=e((h+s)/f)!==e((m+s)/f)?-u:o(n(h)*u,n(m)*u),g=e((h-s)/f)!==e((m-s)/f)?u:a(n(h)*u,n(m)*u),k=e((h+t)/f)!==e((m+t)/f)?u*2:a(u-i(h)*u,u-i(m)*u);c.min.set(y,r[1],d<0?-k:0),c.max.set(g,r[3],d<0?0:k)}else c.min.set(r[0],r[1],0),c.max.set(r[2],r[3],0);c.getBoundingSphere(this.boundingSphere)}}applyClipRect(r){let d=this.getAttribute(Qr).count,c=this._chunkedBounds;if(c)for(let t=c.length;t--;){d=c[t].end;let e=c[t].rect;if(e[1]<r.w&&e[3]>r.y&&e[0]<r.z&&e[2]>r.x)break}this.instanceCount=d}}function ir(l,r,d,c){const t=l.getAttribute(r);d?t&&t.array.length===d.length?(t.array.set(d),t.needsUpdate=!0):(l.setAttribute(r,new AFRAME.THREE.InstancedBufferAttribute(d,c)),delete l._maxInstanceCount,l.dispose()):t&&l.deleteAttribute(r)}const ca=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,ha=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}

position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,da=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);

  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 :
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,va=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function pa(l){const r=ar(l,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new AFRAME.THREE.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new AFRAME.THREE.Vector4(0,0,0,0)},uTroikaClipRect:{value:new AFRAME.THREE.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new AFRAME.THREE.Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new AFRAME.THREE.Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new AFRAME.THREE.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:ca,vertexTransform:ha,fragmentDefs:da,fragmentColorTransform:va,customRewriter({vertexShader:d,fragmentShader:c}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(c)&&(c=c.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(d)||(d=d.replace(Lr,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:d,fragmentShader:c}}});return r.transparent=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),r}const sr=new AFRAME.THREE.MeshBasicMaterial({color:16777215,side:AFRAME.THREE.DoubleSide,transparent:!0}),Zr=8421504,qr=new AFRAME.THREE.Matrix4,Lt=new AFRAME.THREE.Vector3,lr=new AFRAME.THREE.Vector3,yt=[],ga=new AFRAME.THREE.Vector3,fr="+x+y";function $r(l){return Array.isArray(l)?l[0]:l}let en=()=>{const l=new AFRAME.THREE.Mesh(new AFRAME.THREE.PlaneGeometry(1,1),sr);return en=()=>l,l},tn=()=>{const l=new AFRAME.THREE.Mesh(new AFRAME.THREE.PlaneGeometry(1,1,32,1),sr);return tn=()=>l,l};const ma={type:"syncstart"},ya={type:"synccomplete"},rn=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],ba=rn.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class nn extends AFRAME.THREE.Mesh{constructor(){const r=new ua;super(r,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=Zr,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=fr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(r){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(r):(this._isSyncing=!0,this.dispatchEvent(ma),ra({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},d=>{this._isSyncing=!1,this._textRenderInfo=d,this.geometry.updateGlyphs(d.glyphBounds,d.glyphAtlasIndices,d.blockBounds,d.chunkedBounds,d.glyphColors);const c=this._queuedSyncs;c&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{c.forEach(t=>t&&t())})),this.dispatchEvent(ya),r&&r()})))}onBeforeRender(r,d,c,t,e,o){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e),e._hadOwnSide=e.hasOwnProperty("side"),this.geometry.setSide(e._actualSide=e.side),e.side=AFRAME.THREE.FrontSide}onAfterRender(r,d,c,t,e,o){e._hadOwnSide?e.side=e._actualSide:delete e.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let r=this._derivedMaterial;const d=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=sr.clone());if((!r||r.baseMaterial!==d)&&(r=this._derivedMaterial=pa(d),d.addEventListener("dispose",function c(){d.removeEventListener("dispose",c),r.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let c=r._outlineMtl;return c||(c=r._outlineMtl=Object.create(r,{id:{value:r.id+.1}}),c.isTextOutlineMaterial=!0,c.depthWrite=!1,c.map=null,r.addEventListener("dispose",function t(){r.removeEventListener("dispose",t),c.dispose()})),[c,r]}else return r}set material(r){r&&r.isTroikaTextMaterial?(this._derivedMaterial=r,this._baseMaterial=r.baseMaterial):this._baseMaterial=r}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(r){this.geometry.detail=r}get curveRadius(){return this.geometry.curveRadius}set curveRadius(r){this.geometry.curveRadius=r}get customDepthMaterial(){return $r(this.material).getDepthMaterial()}get customDistanceMaterial(){return $r(this.material).getDistanceMaterial()}_prepareForRender(r){const d=r.isTextOutlineMaterial,c=r.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:a,blockBounds:n}=t;c.uTroikaSDFTexture.value=a,c.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height),c.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,c.uTroikaSDFExponent.value=t.sdfExponent,c.uTroikaTotalBounds.value.fromArray(n),c.uTroikaUseGlyphColors.value=!d&&!!t.glyphColors;let i=0,s=0,f=0,u,h,m,y=0,g=0;if(d){let{outlineWidth:p,outlineOffsetX:T,outlineOffsetY:w,outlineBlur:_,outlineOpacity:S}=this;i=this._parsePercent(p)||0,s=Math.max(0,this._parsePercent(_)||0),u=S,y=this._parsePercent(T)||0,g=this._parsePercent(w)||0}else f=Math.max(0,this._parsePercent(this.strokeWidth)||0),f&&(m=this.strokeColor,c.uTroikaStrokeColor.value.set(m??Zr),h=this.strokeOpacity,h==null&&(h=1)),u=this.fillOpacity;c.uTroikaDistanceOffset.value=i,c.uTroikaPositionOffset.value.set(y,g),c.uTroikaBlurRadius.value=s,c.uTroikaStrokeWidth.value=f,c.uTroikaStrokeOpacity.value=h,c.uTroikaFillOpacity.value=u??1,c.uTroikaCurveRadius.value=this.curveRadius||0;let k=this.clipRect;if(k&&Array.isArray(k)&&k.length===4)c.uTroikaClipRect.value.fromArray(k);else{const p=(this.fontSize||.1)*100;c.uTroikaClipRect.value.set(n[0]-p,n[1]-p,n[2]+p,n[3]+p)}this.geometry.applyClipRect(c.uTroikaClipRect.value)}c.uTroikaSDFDebug.value=!!this.debugSDF,r.polygonOffset=!!this.depthOffset,r.polygonOffsetFactor=r.polygonOffsetUnits=this.depthOffset||0;const e=d?this.outlineColor||0:this.color;if(e==null)delete r.color;else{const a=r.hasOwnProperty("color")?r.color:r.color=new AFRAME.THREE.Color;(e!==a._input||typeof e=="object")&&a.set(a._input=e)}let o=this.orientation||fr;if(o!==r._orientation){let a=c.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let n=o!==fr&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,i,s,f,u]=n;Lt.set(0,0,0)[s]=i==="-"?1:-1,lr.set(0,0,0)[u]=f==="-"?-1:1,qr.lookAt(ga,Lt.cross(lr),lr),a.setFromMatrix4(qr)}else a.identity();r._orientation=o}}_parsePercent(r){if(typeof r=="string"){let d=r.match(/^(-?[\d.]+)%$/),c=d?parseFloat(d[1]):NaN;r=(isNaN(c)?0:c/100)*this.fontSize}return r}localPositionToTextCoords(r,d=new AFRAME.THREE.Vector2){d.copy(r);const c=this.curveRadius;return c&&(d.x=Math.atan2(r.x,Math.abs(c)-Math.abs(r.z))*Math.abs(c)),d}worldPositionToTextCoords(r,d=new AFRAME.THREE.Vector2){return Lt.copy(r),this.localPositionToTextCoords(this.worldToLocal(Lt),d)}raycast(r,d){const{textRenderInfo:c,curveRadius:t}=this;if(c){const e=c.blockBounds,o=t?tn():en(),a=o.geometry,{position:n,uv:i}=a.attributes;for(let s=0;s<i.count;s++){let f=e[0]+i.getX(s)*(e[2]-e[0]);const u=e[1]+i.getY(s)*(e[3]-e[1]);let h=0;t&&(h=t-Math.cos(f/t)*t,f=Math.sin(f/t)*t),n.setXYZ(s,f,u,h)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,yt.length=0,o.raycast(r,yt);for(let s=0;s<yt.length;s++)yt[s].object=this,d.push(yt[s])}}copy(r){const d=this.geometry;return super.copy(r),this.geometry=d,ba.forEach(c=>{this[c]=r[c]}),this}clone(){return new this.constructor().copy(this)}}rn.forEach(l=>{const r="_private_"+l;Object.defineProperty(nn.prototype,l,{get(){return this[r]},set(d){d!==this[r]&&(this[r]=d,this._needsSync=!0)}})});var ur="troika-text";function bt(l){return{default:l,parse:function(r){return typeof r=="string"&&r.indexOf("%")>0?r:(r=+r,isNaN(r)?0:r)},stringify:function(r){return""+r}}}Be.default.registerComponent(ur,{schema:{align:{type:"string",default:"left",oneOf:["left","right","center","justify"]},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},clipRect:{type:"string",default:"",parse:function(l){return l&&(l=l.split(/[\s,]+/).reduce(function(r,d){return d=+d,isNaN(d)||r.push(d),r},[])),l&&l.length===4?l:null},stringify:function(l){return l?l.join(" "):""}},color:{type:"color",default:"#FFF"},colorRanges:{type:"string",default:null,parse:function(l){return typeof l=="string"?JSON.parse(l):l},stringify:JSON.stringify},curveRadius:{type:"number",default:0},depthOffset:{type:"number",default:0},direction:{type:"string",default:"auto",oneOf:["auto","ltr","rtl"]},fillOpacity:{type:"number",default:1},font:{type:"string"},fontSize:{type:"number",default:.2},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},maxWidth:{type:"number",default:1/0},outlineBlur:bt(0),outlineColor:{type:"color",default:"#000"},outlineOffsetX:bt(0),outlineOffsetY:bt(0),outlineOpacity:{type:"number",default:1},outlineWidth:bt(0),overflowWrap:{type:"string",default:"normal",oneOf:["normal","break-word"]},strokeColor:{type:"color",default:"grey"},strokeOpacity:{type:"number",default:1},strokeWidth:bt(0),textIndent:{type:"number",default:0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","nowrap"]}},init:function(){var l,r=this.el.tagName.toLowerCase()==="a-troika-text";r?l=this.el:(l=at.createElement("a-entity"),this.el.appendChild(l)),this.troikaTextEntity=l;var d=this.troikaTextMesh=new nn;l.setObject3D("mesh",d)},update:function(){var l=this.data,r=this.troikaTextMesh,d=this.troikaTextEntity,c=l.font;if(r.text=(l.value||"").replace(/\\n/g,`
`).replace(/\\t/g,"	"),r.textAlign=l.align,l.font.startsWith("#")&&(c=at.querySelector(l.font).getAttribute("src")),r.anchorX=_a[l.anchor==="align"?l.align:l.anchor]||"center",r.anchorY=Ta[l.baseline]||"middle",r.color=l.color,r.colorRanges=l.colorRanges,r.clipRect=l.clipRect,r.curveRadius=l.curveRadius,r.depthOffset=l.depthOffset||0,r.direction=l.direction,r.fillOpacity=l.fillOpacity,r.font=c,r.fontSize=l.fontSize,r.letterSpacing=l.letterSpacing||0,r.lineHeight=l.lineHeight||"normal",r.outlineBlur=l.outlineBlur,r.outlineColor=l.outlineColor,r.outlineOffsetX=l.outlineOffsetX,r.outlineOffsetY=l.outlineOffsetY,r.outlineOpacity=l.outlineOpacity,r.outlineWidth=l.outlineWidth,r.overflowWrap=l.overflowWrap,r.strokeColor=l.strokeColor,r.strokeOpacity=l.strokeOpacity,r.strokeWidth=l.strokeWidth,r.textIndent=l.textIndent,r.whiteSpace=l.whiteSpace,r.maxWidth=l.maxWidth,r.sync(),d!==this.el){var t=this.el.getAttribute("troika-text-material");t?d.setAttribute("material",t):d.removeAttribute("material")}},remove:function(){this.troikaTextMesh.dispose(),this.troikaTextEntity!==this.el&&this.el.removeChild(this.troikaTextEntity)}});var _a={left:"left",center:"center",right:"right"},Ta={top:"top",center:"middle",bottom:"bottom"},an={},Ua=Be.default.components[ur].schema;Object.keys(Ua).map(function(l){var r=l.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();an[r]=ur+"."+l}),Be.default.registerPrimitive("a-troika-text",{defaultComponents:{"troika-text":{}},mappings:an}),function(l){l.MathUtils||(l.MathUtils=l.Math)}(Ee)})(AFRAME.THREE,AFRAME);var La=Object.defineProperty,Ba=Object.getOwnPropertyDescriptor,Ia=(we,se,ge,Ue)=>{for(var Ee=Ue>1?void 0:Ue?Ba(se,ge):se,Be=we.length-1,ze;Be>=0;Be--)(ze=we[Be])&&(Ee=(Ue?ze(se,ge,Ee):ze(Ee))||Ee);return Ue&&Ee&&La(se,ge,Ee),Ee},er;let An=(er=class extends Dr{constructor(){super(...arguments);nt(this,"animDuration",200);nt(this,"animEasing","easeOutCubic");nt(this,"textElem")}init(){this.el.addEventListener("componentchanged",se=>{se.detail.name==="visible"&&this.updateClickable()}),this.updateClickable(),this.updateAnimations(),this.data.text!=""&&(this.textElem=at.createEntity("a-troika-text"),this.textElem.setAttribute("value",this.data.text),this.textElem.setAttribute("color",this.data.textColor),this.textElem.setAttribute("position",{x:0,y:0,z:.001}),this.el.append(this.textElem))}updateClickable(){const se=this.el.getAttribute("visible");this.el.classList.contains("clickable")?se||this.el.classList.remove("clickable"):se&&this.el.classList.add("clickable")}updateAnimations(se=this.animDuration,ge=this.animEasing){this.el.setAttribute("animation__mouseenter_color",{property:"material.color",to:"#b0b0b0",startEvents:"mouseenter",dur:se,easing:ge}),this.el.setAttribute("animation__mouseleave_color",{property:"material.color",to:"#FFFFFF",startEvents:"mouseleave",dur:se,easing:ge}),this.el.setAttribute("animation__mouseclick_color",{property:"material.color",from:"#828282",to:"#b0b0b0",startEvents:"click",dur:se,easing:ge}),this.textElem&&(this.textElem.setAttribute("animation__mouseenter_textopacity",{property:"troika-text.fillOpacity",to:.8,startEvents:"mouseenter",dur:se,easing:ge}),this.textElem.setAttribute("animation__mouseleave_textopacity",{property:"troika-text.fillOpacity",to:1,startEvents:"mouseleave",dur:se,easing:ge}),this.textElem.setAttribute("animation__mouseclick_textopacity",{property:"troika-text.fillOpacity",from:.5,to:.8,startEvents:"click",dur:se,easing:ge}))}},nt(er,"schema",{text:{default:""},textColor:{type:"color"}}),nt(er,"dependencies",["geometry","material"]),er);An=Ia([Rr("button")],An);function kn(){return Mr.utils.extendDeep({},Mr.primitives.getMeshMixin(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,alphaTest:1e-7},button:{}},mappings:{height:"geometry.height",width:"geometry.width"}})}AFRAME.registerPrimitive("a-button",kn());AFRAME.registerPrimitive("a-text-button",Mr.utils.extendDeep({},{mappings:{label:"button.text","label-color":"button.textColor"}},kn()));export{An as ButtonComponent};
