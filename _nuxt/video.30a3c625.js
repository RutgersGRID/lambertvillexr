var p=Object.defineProperty;var u=(s,t,e)=>t in s?p(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var i=(s,t,e)=>(u(s,typeof t!="symbol"?t+"":t,e),e);import{u as d}from"./AFrameScene.vue.20401d71.js";import{B as m,c as P}from"./component.decorator.a66a1cbe.js";import"./aframe-master.5ce7d00f.js";import"./test-helpers.473cda21.js";import{c as r,q as v}from"./document.6adaffbf.js";import{f as b}from"./three.de5e62c0.js";import"./entry.7f80378a.js";var y=Object.defineProperty,g=Object.getOwnPropertyDescriptor,f=(s,t,e,l)=>{for(var a=l>1?void 0:l?g(t,e):t,o=s.length-1,n;o>=0;o--)(n=s[o])&&(a=(l?n(t,e,a):n(a))||a);return l&&a&&y(t,e,a),a};const E=AFRAME.THREE;var h;let c=(h=class extends m{constructor(){super(...arguments);i(this,"playImageSrc",d("assets/images/play.png"));i(this,"pauseImageSrc",d("assets/images/pause.png"));i(this,"animDuration",200);i(this,"animEasing","easeOutCubic");i(this,"playPlane");i(this,"videoPlane");i(this,"backgroundPlane");i(this,"fadeControlsTimer");i(this,"videoElem");i(this,"isHovering",!1);i(this,"isVideoPlaying",!1);i(this,"controlsVisible",!1)}init(){var t;this.playPlane=r("a-image"),this.videoPlane=r("a-image"),this.backgroundPlane=r("a-plane"),this.backgroundPlane.setAttribute("material",{side:"double",opacity:.75,shader:"flat",color:"black",transparent:!0}),this.backgroundPlane.object3D.renderOrder=-20,this.el.appendChild(this.backgroundPlane),this.playPlane.setAttribute("transparent",!0),this.playPlane.setAttribute("alpha-test",.5),this.el.appendChild(this.videoPlane),this.videoPlane.appendChild(this.playPlane),this.videoPlane.addEventListener("loaded",()=>{this.update()}),this.updateAnimations(this.animDuration),this.videoPlane.addEventListener("mouseenter",()=>{this.isHovering=!0,this.showControls()}),this.videoPlane.addEventListener("mouseleave",()=>{this.isHovering=!1,this.hideControls(),clearTimeout(this.fadeControlsTimer)}),this.videoPlane.addEventListener("click",()=>{!this.controlsVisible||!this.videoElem||(clearTimeout(this.fadeControlsTimer),this.isPlayable()&&(this.isVideoPlaying?(this.isVideoPlaying=!1,this.videoElem.pause()):(this.isVideoPlaying=!0,this.videoElem.play(),this.fadeControlsTimer=setTimeout(()=>this.hideControls(500),1e3)),this.updatePlaybackUI()))}),(t=this.videoElem)==null||t.addEventListener("ended",()=>{this.updatePlaybackUI()}),this.el.addEventListener("componentchanged",e=>{e.detail.name==="visible"&&this.updateClickable()}),this.updateClickable()}updateClickable(){if(!this.videoPlane)return;const t=this.el.getAttribute("visible");this.videoPlane.classList.contains("clickable")?t||this.videoPlane.classList.remove("clickable"):t&&this.videoPlane.classList.add("clickable")}update(){if(!this.videoPlane||!this.playPlane||!this.backgroundPlane)return;const t=.2,e=.3,l=this.data.width<this.data.height?this.data.width:this.data.height;if(this.videoPlane.setAttribute("width",this.data.width),this.playPlane.setAttribute("width",l*e),this.playPlane.object3D.position.copy(new E.Vector3(0,0,.1)),this.backgroundPlane.setAttribute("width",this.data.width+2*t),this.playPlane.setAttribute("height",l*e),this.videoPlane.setAttribute("height",this.data.height),this.backgroundPlane.setAttribute("height",this.data.height+2*t),this.videoElem=v(this.data.src),this.videoPlane.setAttribute("src",this.data.src),this.videoPlane.getObject3D("mesh")){const o=this.videoPlane.getObject3D("mesh").material;o.map&&b(o.map,this.data.width,this.data.height)}this.isVideoPlaying=this.videoElem.currentTime>0&&!this.videoElem.paused&&!this.videoElem.ended&&this.videoElem.readyState>2,this.updatePlaybackUI()}showControls(t=this.animDuration){this.controlsVisible||!this.videoPlane||!this.playPlane||(this.controlsVisible=!0,this.updateAnimations(t),this.videoPlane.emit("showcontrols"),this.playPlane.emit("showcontrols"))}hideControls(t=this.animDuration){!this.controlsVisible||!this.videoPlane||!this.playPlane||(this.controlsVisible=!1,this.updateAnimations(t),this.videoPlane.emit("hidecontrols"),this.playPlane.emit("hidecontrols"))}isPlayable(){return this.videoElem&&this.videoElem.readyState>2}updatePlaybackUI(){var t;(t=this.playPlane)==null||t.setAttribute("material","src",this.isVideoPlaying?this.pauseImageSrc:this.playImageSrc)}updateAnimations(t=this.animDuration,e=this.animEasing){!this.videoPlane||!this.playPlane||(this.playPlane.setAttribute("material","transparent",!0),this.playPlane.setAttribute("material","opacity",0),this.playPlane.setAttribute("animation__showcontrols_opacity",{property:"material.opacity",to:1,startEvents:"showcontrols",dur:t,easing:e}),this.playPlane.setAttribute("animation__hidecontrols_color",{property:"material.opacity",to:0,startEvents:"hidecontrols",dur:t,easing:e}),this.videoPlane.setAttribute("animation__showcontrols_color",{property:"material.color",to:"#686868",startEvents:"showcontrols",dur:t,easing:e}),this.videoPlane.setAttribute("animation__hidecontrols_color",{property:"material.color",to:"#FFFFFF",startEvents:"hidecontrols",dur:t,easing:e}))}},i(h,"schema",{src:{type:"string"},width:{default:16},height:{default:9}}),h);c=f([P("video")],c);AFRAME.registerPrimitive("a-playback-video",{defaultComponents:{video:{}},mappings:{src:"video.src",width:"video.width",height:"video.height"}});export{c as default};
